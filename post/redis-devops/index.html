<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/icon.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"flat"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: true,
    lazyload: false,
    pangu: true,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta property="og:type" content="article">
<meta property="og:title" content="ã€ŠRediså¼€å‘ä¸è¿ç»´ã€‹">
<meta property="og:url" content="https:&#x2F;&#x2F;blog.palemoky.top&#x2F;post&#x2F;redis-devops&#x2F;index.html">
<meta property="og:site_name" content="å¯°å®‡æ˜Ÿè¾°">
<meta property="og:locale" content="en">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;middle&#x2F;006y8mN6ly1g8ronsawmbj30ku0aft9d.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;006y8mN6ly1g8rmou0bzdj30hx0kb0xe.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;006y8mN6ly1g8tfeooj3zj30k60hptbk.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;middle&#x2F;006y8mN6ly1g8u1rzsipij30n811un3c.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;middle&#x2F;006y8mN6ly1g8u27kw8tmj30u00ws7ff.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;006y8mN6ly1g91c1tnqngj30ky0m3djy.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;006y8mN6ly1g91co0mb8fj30g40hz770.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;006y8mN6ly1g91e0yu7flj30if0o442t.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;006y8mN6ly1g91vyy7e25j30h909875n.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;006y8mN6ly1g91xk5bba1j30jh0hejtq.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;006y8mN6ly1g91xn7bm5rj30j30lqgp7.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;006y8mN6ly1g91xwacukej30hu0d8gnx.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;large&#x2F;006y8mN6ly1g91z58ncm8j30iv0frgpv.jpg">
<meta property="og:updated_time" content="2019-11-18T04:57:44.776Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;middle&#x2F;006y8mN6ly1g8ronsawmbj30ku0aft9d.jpg">

<link rel="canonical" href="https://blog.palemoky.top/post/redis-devops/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>ã€ŠRediså¼€å‘ä¸è¿ç»´ã€‹ | å¯°å®‡æ˜Ÿè¾°</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <script type="text/javascript">
    var host = "blog.palemoky.top";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
</script>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">å¯°å®‡æ˜Ÿè¾°</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">ä»¥æœ‰é™å­—ç¬¦åˆ›é€ æ— é™å¯èƒ½<br>Make it possible</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-todo">

    <a href="/todo/" rel="section"><i class="fa fa-fw fa-list"></i>Todo</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/palemoky" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="https://blog.palemoky.top/post/redis-devops/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/orca.jpg">
      <meta itemprop="name" content="Palemoky">
      <meta itemprop="description" content="Learn by doing !">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¯°å®‡æ˜Ÿè¾°">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ã€ŠRediså¼€å‘ä¸è¿ç»´ã€‹
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-09 10:31:49" itemprop="dateCreated datePublished" datetime="2019-11-09T10:31:49+08:00">2019-11-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-18 12:57:44" itemprop="dateModified" datetime="2019-11-18T12:57:44+08:00">2019-11-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index">
                    <span itemprop="name">å­¦ä¹ ç¬”è®°</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/post/redis-devops/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/redis-devops/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="https://tva1.sinaimg.cn/middle/006y8mN6ly1g8ronsawmbj30ku0aft9d.jpg" alt=""></p>
<a id="more"></a>

<h1 id="ç¬¬-1-ç« -åˆè¯†-Redis"><a href="#ç¬¬-1-ç« -åˆè¯†-Redis" class="headerlink" title="ç¬¬ 1 ç«  åˆè¯† Redis"></a>ç¬¬ 1 ç«  åˆè¯† Redis</h1><h2 id="Redis-æ•°æ®ç±»å‹"><a href="#Redis-æ•°æ®ç±»å‹" class="headerlink" title="Redis æ•°æ®ç±»å‹"></a>Redis æ•°æ®ç±»å‹</h2><ul>
<li>string(Bitmaps &amp; HyperLogLog)</li>
<li>hash</li>
<li>list</li>
<li>set</li>
<li>zset</li>
</ul>
<h2 id="Redis-æä¾›çš„åŠŸèƒ½"><a href="#Redis-æä¾›çš„åŠŸèƒ½" class="headerlink" title="Redis æä¾›çš„åŠŸèƒ½"></a>Redis æä¾›çš„åŠŸèƒ½</h2><ul>
<li>é”®è¿‡æœŸ</li>
<li>å‘å¸ƒè®¢é˜…ï¼ˆæ¶ˆæ¯ç³»ç»Ÿï¼‰</li>
<li>äº‹åŠ¡</li>
<li>æµæ°´çº¿ï¼ˆä¸€æ‰¹å‘½ä»¤ä¸€æ¬¡å‘é€åˆ° Redisï¼Œé¿å…ç½‘ç»œå¼€é”€ï¼‰</li>
<li>Lua è„šæœ¬</li>
</ul>
<h2 id="Redis-ä½¿ç”¨åœºæ™¯"><a href="#Redis-ä½¿ç”¨åœºæ™¯" class="headerlink" title="Redis ä½¿ç”¨åœºæ™¯"></a>Redis ä½¿ç”¨åœºæ™¯</h2><ul>
<li>ç¼“å­˜</li>
<li>æ’è¡Œæ¦œ</li>
<li>è®¡æ•°å™¨ï¼ˆè§†é¢‘æ’­æ”¾æ•°ï¼Œå•†å“æµè§ˆé‡ï¼‰</li>
<li>ç¤¾äº¤ï¼ˆå…±åŒå¥½å‹ã€ç²‰ä¸ã€ç‚¹èµï¼‰</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>å…±äº« Session</li>
<li>é™é€Ÿï¼ˆå¦‚ï¼Œ60s è·å–ä¸€æ¬¡æ‰‹æœºéªŒè¯ç ï¼š<code>redis.set(phoneNum, 1, &quot;EX 60&quot;, &quot;NX&quot;)</code>ï¼‰</li>
<li>ä½¿ç”¨å“ˆå¸Œç±»å‹æ¨¡æ‹Ÿå…³ç³»å‹æ•°æ®åº“ï¼ˆä¼˜ç‚¹ï¼šç”¨æˆ·ä¿¡æ¯å†…èšæ€§è¾ƒå¼ºï¼Œå ç”¨çš„é”®è¾ƒå°‘ï¼›ç¼ºç‚¹ï¼šå“ˆå¸Œç±»å‹æ˜¯ç¨€ç–çš„ï¼Œéš¾ä»¥åšå¤æ‚çš„å…³ç³»æŸ¥è¯¢ã€‚æ³¨æ„ï¼šè¦æ§åˆ¶å“ˆå¸Œåœ¨ ziplist å’Œ hashtable ä¸¤ç§å†…éƒ¨ç¼–ç çš„è½¬æ¢ï¼Œhashtable ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼‰</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆ-Redis-å¾ˆå¿«ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-Redis-å¾ˆå¿«ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ Redis å¾ˆå¿«ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ Redis å¾ˆå¿«ï¼Ÿ</h2><ul>
<li>å†…å­˜è®¿é—®</li>
<li>C è¯­è¨€å®ç°</li>
<li>å•çº¿ç¨‹æ¶æ„ï¼Œé¿å…çº¿ç¨‹åˆ‡æ¢ä¸ç«æ€äº§ç”Ÿçš„æ¶ˆè€—</li>
<li>I/O å¤šè·¯å¤ç”¨æ¨¡å‹ï¼ˆepollï¼‰</li>
</ul>
<p>å®‰è£…è½¯ä»¶æ—¶ï¼Œä¸ºè½¯ä»¶å»ºç«‹è½¯è¿æ¥æ˜¯ä¸€ç§å¥½ä¹ æƒ¯ï¼Œé¿å…å°†è½¯ä»¶å›ºå®šåœ¨æŒ‡å®šç‰ˆæœ¬ä¸Šï¼Œæœ‰åˆ©äºæœªæ¥è½¯ä»¶çš„ç‰ˆæœ¬å‡çº§ã€‚</p>
<p>Redis å€Ÿé‰´äº† Linux å¯¹äºç‰ˆæœ¬å·çš„å‘½åè§„åˆ™ï¼šç‰ˆæœ¬å·ç¬¬äºŒä½å¦‚æœæ˜¯å¥‡æ•°ï¼Œåˆ™ä¸ºéç¨³å®šç‰ˆæœ¬ï¼ˆå¦‚ 2.7ã€2.9ã€3.1ï¼‰ï¼Œå¦åˆ™ä¸ºç¨³å®šç‰ˆæœ¬ï¼ˆå¦‚ 2.6ã€2.8ã€3.0ï¼‰</p>
<h2 id="Redis-å¯æ‰§è¡Œæ–‡ä»¶è¯´æ˜"><a href="#Redis-å¯æ‰§è¡Œæ–‡ä»¶è¯´æ˜" class="headerlink" title="Redis å¯æ‰§è¡Œæ–‡ä»¶è¯´æ˜"></a>Redis å¯æ‰§è¡Œæ–‡ä»¶è¯´æ˜</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>redis-server</code></td>
<td>å¯åŠ¨ Redis</td>
</tr>
<tr>
<td><code>redis-cli</code></td>
<td>Redis å‘½ä»¤è¡Œå®¢æˆ·ç«¯</td>
</tr>
<tr>
<td><code>redis-cli shutdown</code></td>
<td>å…³é—­ Redis</td>
</tr>
<tr>
<td><code>redis-benchmark</code></td>
<td>Redis åŸºå‡†æµ‹è¯•å·¥å…·</td>
</tr>
<tr>
<td><code>redis-check-of</code></td>
<td>Redis AOF æŒä¹…åŒ–æ–‡ä»¶æ£€æµ‹ä¸ä¿®å¤å·¥å…·</td>
</tr>
<tr>
<td><code>redis-check-dump</code></td>
<td>Redis RDB æŒä¹…åŒ–æ–‡ä»¶æ£€æµ‹ä¸ä¿®å¤å·¥å…·</td>
</tr>
<tr>
<td><code>redis-sentinel</code></td>
<td>å¯åŠ¨ Redis Sentinel</td>
</tr>
</tbody></table>
<h2 id="å¯åŠ¨-Redis-çš„3ç§æ–¹å¼ï¼š"><a href="#å¯åŠ¨-Redis-çš„3ç§æ–¹å¼ï¼š" class="headerlink" title="å¯åŠ¨ Redis çš„3ç§æ–¹å¼ï¼š"></a>å¯åŠ¨ Redis çš„3ç§æ–¹å¼ï¼š</h2><ol>
<li>é»˜è®¤é…ç½®(<code>redis-server</code>)</li>
<li>è¿è¡Œé…ç½®(<code>redis-server --port 6380</code>)</li>
<li>é…ç½®æ–‡ä»¶(<code>redis-server /opt/redis/redis.conf</code>)</li>
</ol>
<h1 id="ç¬¬-2-ç« -API-çš„ç†è§£å’Œä½¿ç”¨"><a href="#ç¬¬-2-ç« -API-çš„ç†è§£å’Œä½¿ç”¨" class="headerlink" title="ç¬¬ 2 ç«  API çš„ç†è§£å’Œä½¿ç”¨"></a>ç¬¬ 2 ç«  API çš„ç†è§£å’Œä½¿ç”¨</h1><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>é€‰é¡¹</th>
<th>è¿”å›å€¼</th>
<th>å«ä¹‰</th>
<th>å¤æ‚åº¦</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>keys pattern</code></td>
<td>pattern ä½¿ç”¨çš„æ˜¯ glob é£æ ¼çš„é€šé…ç¬¦</td>
<td></td>
<td>æŸ¥çœ‹æ‰€æœ‰é”®</td>
<td>$O(n)$</td>
<td>å¤§é‡é”®æ—¶ç¦æ­¢ä½¿ç”¨</td>
</tr>
<tr>
<td><code>dbsize</code></td>
<td></td>
<td>intï¼ˆ&gt;=0ï¼‰</td>
<td>é”®æ€»æ•°</td>
<td>$O(1)$</td>
<td>ä¸éå†é”®ï¼Œç›´æ¥è¯»å–å†…ç½®é”®æ€»æ•°</td>
</tr>
<tr>
<td><code>exists key</code></td>
<td></td>
<td>intboolï¼ˆå­˜åœ¨ä¸º 1ï¼Œå¦åˆ™ä¸º 0ï¼‰</td>
<td>æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>del key [key ...]</code></td>
<td></td>
<td>intï¼ˆæˆåŠŸåˆ é™¤çš„ä¸ªæ•°ï¼Œè‹¥åˆ é™¤ä¸å­˜åœ¨çš„é”®ï¼Œè¿”å› 0ï¼‰</td>
<td>åˆ é™¤é”®</td>
<td>$O(k)$ï¼Œğ‘˜ä¸ºé”®çš„ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>expire key seconds</code><br><br><code>expireat key timestamp</code><br><br><code>pexpire key milliseconds</code><br><br><code>pexpireat key milliseconds-timestamp</code></td>
<td></td>
<td>boolintï¼ˆæˆåŠŸä¸º 1ï¼Œkey ä¸å­˜åœ¨æˆ–æ— æ³•è®¾ç½®ä¸º 0ï¼‰</td>
<td>é”®è¿‡æœŸ</td>
<td></td>
<td>1. æ— è®ºä½¿ç”¨å“ªç§å½¢å¼ï¼Œåœ¨ Redis å†…éƒ¨æœ€ç»ˆä½¿ç”¨çš„éƒ½æ˜¯<code>pexpireat</code>ï¼›<br>2. å¦‚æœ<code>expire key</code>çš„é”®ä¸å­˜åœ¨ï¼Œè¿”å› 0;<br>3. å¦‚æœè¿‡æœŸæ—¶é—´ä¸ºè´Ÿå€¼ï¼Œé”®ä¼šè¢«ç«‹å³åˆ é™¤ï¼ŒçŠ¹å¦‚ä½¿ç”¨äº†<code>del</code>;<br>4. <code>persist key</code>å¯ä»¥å°†é”®çš„è¿‡æœŸæ—¶é—´æ¸…é™¤ï¼›<br>5. <strong>å¯¹äºå­—ç¬¦ä¸²ç±»å‹é”®ï¼Œæ‰§è¡Œ<code>set</code>å‘½ä»¤ä¼šå»æ‰è¿‡æœŸæ—¶é—´</strong>;<br>6. Redis ä¸æ”¯æŒäºŒçº§æ•°æ®ç»“æ„ï¼ˆå“ˆå¸Œã€åˆ—è¡¨ï¼‰å†…éƒ¨å…ƒç´ çš„è¿‡æœŸåŠŸèƒ½ï¼Œå¦‚ä¸èƒ½å¯¹åˆ—è¡¨ç±»å‹çš„ä¸€ä¸ªå…ƒç´ åšè¿‡æœŸæ—¶é—´è®¾ç½®ï¼›<br>7. <code>setex</code>ä½œä¸º<code>set</code>+<code>expire</code>çš„ç»„åˆï¼Œä¸ä½†æ˜¯åŸå­æ‰§è¡Œï¼ŒåŒæ—¶å‡å°‘äº†ä¸€æ¬¡ç½‘ç»œé€šè®¯çš„æ—¶é—´</td>
</tr>
<tr>
<td><code>ttl key</code><br><code>pttl key</code></td>
<td></td>
<td>intï¼ˆ&gt;=0ï¼šé”®å‰©ä½™è¿‡æœŸæ—¶é—´ï¼›-1ï¼šé”®æœªè®¾ç½®è¿‡æœŸæ—¶é—´ï¼›-2ï¼šé”®ä¸å­˜åœ¨ï¼‰</td>
<td>æŸ¥çœ‹é”®å‰©ä½™å­˜æ´»æ—¶é—´ï¼ˆç§’/æ¯«ç§’ï¼‰</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>type key</code></td>
<td></td>
<td>é”®å­˜åœ¨è¿”å›æ•°æ®ç±»å‹ï¼Œä¸å­˜åœ¨è¿”å› none</td>
<td>æŸ¥çœ‹é”®çš„æ•°æ®ç±»å‹</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>rename key newkey</code><br><code>renamenx key newkey</code></td>
<td></td>
<td>æˆåŠŸè¿”å›<code>OK</code>,å¤±è´¥ä¸º 0</td>
<td>é”®é‡å‘½å</td>
<td></td>
<td>1. å¦‚æœåœ¨é‡å‘½åä¹‹å‰ï¼Œé”®å€¼å·²ç»å­˜åœ¨ï¼Œåˆ™å€¼ä¼šè¢«è¦†ç›–ï¼›<br>2. ç”±äºé‡å‘½åé”®æœŸé—´ä¼šæ‰§è¡Œ<code>del</code>åˆ é™¤æ—§é”®ï¼Œå¦‚æœé”®å¯¹åº”çš„å€¼è¾ƒå¤§ï¼Œå¯èƒ½ä¼šè¢«é˜»å¡</td>
</tr>
<tr>
<td><code>randomkey</code></td>
<td></td>
<td></td>
<td>éšæœºè¿”å›ä¸€ä¸ªé”®</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>move key db</code><br><br><code>dump key</code> + <code>restore key ttl value</code><br><br><code>migrate host port key|&quot;&quot; destination-db timeout [copy] [replace] [keys key [key ...]]</code></td>
<td><code>ttl</code>ä¸º 0 æ—¶è¡¨ç¤ºæ— è¿‡æœŸæ—¶é—´<br><code>host</code>:ç›®æ ‡ä¸»æœº<br><code>port</code>:ç›®æ ‡ç«¯å£<br><code>key|&quot;&quot;</code>:è¿ç§»å•ä¸ªé”®æŒ‡å®šé”®åï¼Œå¤šä¸ªé”®åˆ™ä¸ºç©ºå­—ç¬¦ä¸²<br><code>destination-db</code>:ç›®æ ‡ db ç´¢å¼•<br><code>timeout</code>:è¿ç§»çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰<br><code>copy</code>:ä¸åˆ é™¤æºé”®<br><code>replace</code>:å¯¹ç›®æ ‡ Redis è¦†å†™æ“ä½œã€‚è‹¥æœªæŒ‡å®šï¼Œæº Redis å’Œç›®æ ‡ Redis å­˜åœ¨åŒåé”®ä¼šæŠ¥é”™<br><code>keys key [key ...]</code>:è¿ç§»çš„é”®å</td>
<td></td>
<td>è¿ç§»é”®</td>
<td></td>
<td>æ–¹å¼äºŒä¸­ï¼Œ<code>dump</code>ä¼šå°†é”®å€¼åºåˆ—åŒ–ï¼Œæ ¼å¼é‡‡ç”¨ RDB æ ¼å¼ï¼Œåœ¨ç›®æ ‡ Redis ä¸Šï¼Œ<code>restore</code>å†å°†åºåˆ—åŒ–çš„å€¼å¤åŸ<br><br><code>migrate</code>å®è´¨ä¸Šæ˜¯<code>dump</code>ã€<code>restore</code>ã€<code>del</code>ä¸‰ä¸ªå‘½ä»¤çš„ç»„åˆã€‚<code>migrate</code>å…·æœ‰åŸå­æ€§ï¼Œåªéœ€åœ¨æº Redis ä¸Šæ‰§è¡Œå³å¯ï¼Œç›®æ ‡ Redis å®Œæˆ<code>restore</code>åè¿”å› OKï¼Œæº Redis å†æ ¹æ®<code>migrate</code>çš„å¯¹åº”é€‰é¡¹å†³å®šæ˜¯å¦åœ¨æº Redis ä¸Šåˆ é™¤å¯¹åº”çš„é”®</td>
</tr>
<tr>
<td><code>scan cursor [match pattern] [count number]</code></td>
<td><code>cursor</code>ï¼šæ¸¸æ ‡ï¼Œç¬¬ä¸€æ¬¡éå†ä»0å¼€å§‹ï¼Œæ¯æ¬¡<code>scan</code>éå†å®Œéƒ½ä¼šè¿”å›å½“å‰æ¸¸æ ‡çš„å€¼ï¼Œç›´åˆ°æ¸¸æ ‡å€¼ä¸º0ï¼Œè¡¨ç¤ºéå†ç»“æŸ<br><code>Â·match pattern</code>ï¼šæ¨¡å¼åŒ¹é…<br><code>count number</code>ï¼šæ˜æ¯æ¬¡è¦éå†çš„é”®ä¸ªæ•°ï¼Œé»˜è®¤å€¼æ˜¯10ï¼Œæ­¤å‚æ•°å¯ä»¥é€‚å½“å¢å¤§</td>
<td></td>
<td>æ¸è¿›å¼éå†</td>
<td></td>
<td>å¦‚æœåœ¨éå†è¿‡ç¨‹ä¸­é”®å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™ç»“æœå¯èƒ½æ˜¯ä¸å‡†ç¡®çš„ï¼›<br><code>hscan</code> è§£å†³ <code>hgetall</code> çš„é˜»å¡<br><code>sscan</code>è§£å†³<code>smembers</code> çš„é˜»å¡<br><code>zscan</code>è§£å†³<code>zrange</code> çš„é˜»å¡</td>
</tr>
<tr>
<td><code>select dbIndex</code></td>
<td></td>
<td></td>
<td>åˆ‡æ¢æ•°æ®åº“</td>
<td></td>
<td>é»˜è®¤ 16 ä¸ªæ•°æ®åº“(0~15)ï¼ŒæœªæŒ‡å®šæ•°æ®åº“æ—¶ï¼Œé»˜è®¤ä¸º 0 æ•°æ®åº“;<br>å»ºè®®åªä½¿ç”¨ 0 å·æ•°æ®åº“ï¼Œé¿å…å¤šæ•°æ®åº“çš„åˆ‡æ¢é”™è¯¯ï¼Œä»¥åŠæ•…éšœæ’æŸ¥å›°éš¾ã€‚å¦‚æœéœ€è¦ä½¿ç”¨å¤šæ•°æ®åº“ï¼Œå¯ä»¥åœ¨å•æœºéƒ¨ç½²å¤šä¸ª Redis å®ä¾‹ï¼Œé€šè¿‡ç«¯å£åŒºåˆ†ä¸åŒæ•°æ®åº“</td>
</tr>
<tr>
<td><code>flushdb</code><br><code>flushall</code></td>
<td></td>
<td></td>
<td>æ¸…ç©ºå½“å‰/æ‰€æœ‰æ•°æ®åº“</td>
<td></td>
<td>è‹¥æ•°æ®åº“é”®å€¼è¾ƒå¤šï¼Œå¯èƒ½å¼•å‘é˜»å¡</td>
</tr>
<tr>
<td><strong>å­—ç¬¦ä¸² String</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>set key value [ex seconds] [px milliseconds] [nx|xx]</code></td>
<td>exï¼šè®¾ç½®ç§’çº§è¿‡æœŸæ—¶é—´<br>pxï¼šè®¾ç½®æ¯«ç§’çº§è¿‡æœŸæ—¶é—´<br>nxï¼šé”®ä¸å­˜åœ¨æ‰èƒ½è®¾ç½®æˆåŠŸï¼Œç”¨äºæ·»åŠ <br>xxï¼šé”®å­˜åœ¨æ‰èƒ½è®¾ç½®æˆåŠŸï¼Œç”¨äºæ›´æ–°</td>
<td>æˆåŠŸè¿”å› OKï¼Œå¤±è´¥è¿”å› 0</td>
<td>è®¾ç½®å€¼</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>setex key seconds value</code></td>
<td></td>
<td>æˆåŠŸè¿”å› OKï¼Œå¤±è´¥è¿”å› 0</td>
<td>è®¾å®šçš„å€¼å­˜åœ¨æ‰ä¼šæˆåŠŸ</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>setnx key value</code></td>
<td></td>
<td>æˆåŠŸè¿”å› OKï¼Œå¤±è´¥è¿”å› 0</td>
<td>è®¾å®šçš„å€¼ä¸å­˜åœ¨æ‰ä¼šæˆåŠŸ</td>
<td></td>
<td>å¸¸ç”¨äºåˆ†å¸ƒå¼é”</td>
</tr>
<tr>
<td><code>get key</code></td>
<td></td>
<td>é”®å­˜åœ¨æ—¶è¿”å›å€¼ï¼Œä¸å­˜åœ¨è¿”å› nil</td>
<td>è·å–å€¼</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>mset key value [key value ...]</code></td>
<td></td>
<td>æˆåŠŸè¿”å› OKï¼Œå¤±è´¥è¿”å› 0</td>
<td>æ‰¹é‡è®¾ç½®å€¼</td>
<td>$O(k)$ï¼Œğ‘˜ä¸ºé”®çš„ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>mget key [key ...]</code></td>
<td></td>
<td>é”®å­˜åœ¨æ—¶è¿”å›å€¼ï¼Œä¸å­˜åœ¨è¿”å› nilã€‚ç»“æœæŒ‰ç…§ä¼ å…¥é”®çš„é¡ºåºè¿”å›</td>
<td>æ‰¹é‡è·å–å€¼</td>
<td>$O(k)$ï¼Œğ‘˜ä¸ºé”®çš„ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>incr key</code></td>
<td></td>
<td>å€¼ä¸æ˜¯æ•´æ•°ï¼Œè¿”å›é”™è¯¯<br>å€¼æ˜¯æ•´æ•°ï¼Œè¿”å›è‡ªå¢åç»“æœ<br>é”®ä¸å­˜åœ¨ï¼ŒæŒ‰ç…§å€¼ä¸º 0 è‡ªå¢ï¼Œè¿”å›ç»“æœä¸º 1</td>
<td>å€¼è‡ªå¢</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>decr key</code></td>
<td></td>
<td>int</td>
<td>å€¼è‡ªå‡</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>incrby key increment</code></td>
<td></td>
<td>int</td>
<td>è‡ªå¢æŒ‡å®šæ•°å­—</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>decrby key decrement</code></td>
<td></td>
<td>int</td>
<td>è‡ªå‡æŒ‡å®šæ•°å­—</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>incrbyfloat key increment</code></td>
<td></td>
<td>float</td>
<td>è‡ªå¢æµ®ç‚¹æ•°</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>append key value</code></td>
<td></td>
<td>intï¼ˆè¿”å›è¿½åŠ åçš„å­—ç¬¦é•¿åº¦ï¼‰</td>
<td>å‘å­—ç¬¦ä¸²å°¾éƒ¨è¿½åŠ å€¼</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>strlen key</code></td>
<td></td>
<td>intï¼ˆæ ¹æ®ä¸åŒç¼–ç è¿”å›å­—ç¬¦é•¿åº¦ï¼Œå¦‚ UTF8 çš„â€œä¸­å›½â€è¿”å›å€¼ä¸º 6ï¼‰</td>
<td>å­—ç¬¦ä¸²é•¿åº¦</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>getset key value</code></td>
<td></td>
<td></td>
<td>è®¾ç½®å¹¶è¿”å›å€¼</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>setrange key offeset value</code></td>
<td></td>
<td>intï¼ˆè¿”å›å­—ç¬¦é•¿åº¦ï¼‰</td>
<td>è®¾ç½®æŒ‡å®šä½ç½®çš„å­—ç¬¦</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>getrange key start end</code></td>
<td></td>
<td>è¿”å›æˆªå–çš„å­—ç¬¦å†…å®¹</td>
<td>è·å–éƒ¨åˆ†å­—ç¬¦ä¸²</td>
<td>$O(n)$ï¼Œğ‘› ä¸ºå­—ç¬¦ä¸²é•¿åº¦ï¼Œç”±äºè·å–å­—ç¬¦ä¸²éå¸¸å¿«ï¼Œè‹¥å­—ç¬¦ä¸²ä¸æ˜¯å¾ˆé•¿ï¼Œå¯ä»¥è§†ä¸º$O(1)$</td>
<td></td>
</tr>
<tr>
<td><strong>å“ˆå¸Œ Hash</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>hset key field value</code><br><code>hget key field</code></td>
<td></td>
<td></td>
<td>è®¾ç½®å€¼<br>è·å–å€¼</td>
<td>$O(1)$<br>$O(1)$</td>
<td>åœ¨ Redis ä¸­ï¼Œå“ˆå¸Œç±»å‹æ˜¯æŒ‡é”®å€¼æœ¬èº«åˆæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ç»“æ„ï¼ˆå½¢å¦‚ JSONï¼‰ã€‚å“ˆå¸Œç±»å‹ä¸­çš„æ˜ å°„å…³ç³»å«ä½œfield-valueï¼Œæ³¨æ„è¿™é‡Œçš„valueæ˜¯æŒ‡fieldå¯¹åº”çš„å€¼ï¼Œä¸æ˜¯é”®å¯¹åº”çš„å€¼ï¼Œè¯·æ³¨æ„valueåœ¨ä¸åŒä¸Šä¸‹æ–‡çš„ä½œç”¨ã€‚</td>
</tr>
<tr>
<td><code>hdel key field [field ...]</code></td>
<td></td>
<td>int ï¼ˆæˆåŠŸä¸ºåˆ é™¤çš„ä¸ªæ•°ï¼‰</td>
<td>åˆ é™¤ field</td>
<td>$O(k)$ ï¼Œğ‘˜æ˜¯fieldä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>hlen key</code></td>
<td></td>
<td>int</td>
<td>è®¡ç®— field ä¸ªæ•°</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>hmset key field value [field value ...]</code><br><code>hmget key field [field ...]</code></td>
<td></td>
<td></td>
<td>æ‰¹é‡è®¾ç½®æˆ–è·å–field-value</td>
<td>$O(k)$ ï¼Œğ‘˜æ˜¯fieldä¸ªæ•°<br>$O(k)$ ï¼Œğ‘˜æ˜¯fieldä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>hexists key field</code></td>
<td></td>
<td>å­˜åœ¨ä¸º 1ï¼Œå¦åˆ™ä¸º 0</td>
<td>åˆ¤æ–­fieldæ˜¯å¦å­˜åœ¨</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>hsetnx key field value</code></td>
<td></td>
<td></td>
<td></td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>hkeys key</code></td>
<td></td>
<td></td>
<td>è·å–æ‰€æœ‰field</td>
<td>$O(n)$ ï¼Œğ‘› æ˜¯fieldä¸ªæ•°</td>
<td><code>hkeys</code> å« <code>hfields</code>æ›´æ°å½“</td>
</tr>
<tr>
<td><code>hvals key</code></td>
<td></td>
<td></td>
<td>è·å–æ‰€æœ‰value</td>
<td>$O(n)$ ï¼Œğ‘› æ˜¯fieldä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>hgetall key</code></td>
<td></td>
<td></td>
<td>è·å–æ‰€æœ‰çš„field-value</td>
<td>$O(n)$ ï¼Œğ‘› æ˜¯fieldä¸ªæ•°</td>
<td>åœ¨ä½¿ç”¨<code>hgetall</code>æ—¶ï¼Œå¦‚æœå“ˆå¸Œå…ƒç´ ä¸ªæ•°æ¯”è¾ƒå¤šï¼Œå¯èƒ½ä¼šé˜»å¡Redisã€‚å¦‚æœå¼€å‘äººå‘˜åªéœ€è¦è·å–éƒ¨åˆ†fieldï¼Œå¯ä»¥ä½¿ç”¨<code>hmget</code>ï¼Œå¦‚æœä¸€å®šè¦è·å–å…¨éƒ¨field-valueï¼Œå¯ä»¥ä½¿ç”¨<code>hscan</code>å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šæ¸è¿›å¼éå†å“ˆå¸Œç±»å‹ã€‚</td>
</tr>
<tr>
<td><code>hincrby key field</code><br><code>hincrbyfloat key field</code></td>
<td></td>
<td></td>
<td>æŒ‰æŒ‡å®šå€¼é€’å¢</td>
<td>$O(1)$<br>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>hstrlen key field</code></td>
<td></td>
<td></td>
<td>è®¡ç®—valueçš„å­—ç¬¦ä¸²é•¿åº¦</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td>åˆ—è¡¨ List</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>lpush key value [value ...]</code><br><code>rpush key value [value ...]</code></td>
<td></td>
<td>intï¼ˆæˆåŠŸæ’å…¥å…ƒç´ ä¸ªæ•°ï¼‰</td>
<td>ä»å·¦/å³ä¾§æ’å…¥å…ƒç´ </td>
<td>$O(k)$ï¼Œğ‘˜ ä¸ºå…ƒç´ ä¸ªæ•°</td>
<td>åˆ—è¡¨ç±»å‹çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼šç¬¬ä¸€ï¼Œåˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯æœ‰åºçš„ï¼ˆå³ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•ä¸‹æ ‡è·å–å…ƒç´ ï¼‰ï¼›ç¬¬äºŒï¼Œåˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯é‡å¤çš„</td>
</tr>
<tr>
<td><code>lpop key</code><br><code>rpop key</code></td>
<td></td>
<td></td>
<td>ä»åˆ—è¡¨å·¦/å³ä¾§å¼¹å‡ºå…ƒç´ </td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>linsert key before|after pivot value</code></td>
<td></td>
<td>intï¼ˆè¿”å›å½“å‰åˆ—è¡¨é•¿åº¦ï¼‰</td>
<td>å‘æŸä¸ªå…ƒç´ å‰æˆ–è€…åæ’å…¥å…ƒç´ </td>
<td>$O(n)$ï¼Œğ‘› æ˜¯ pivot è·ç¦»åˆ—è¡¨å¤´æˆ–å°¾çš„è·ç¦»</td>
<td></td>
</tr>
<tr>
<td><code>lrange key start end</code></td>
<td></td>
<td></td>
<td>è·å–æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ åˆ—è¡¨</td>
<td>$O(s+n)$ï¼Œğ‘  æ˜¯ start åç§»é‡ï¼Œğ‘› æ˜¯start åˆ° end çš„èŒƒå›´</td>
<td>1. <code>lrange 0 -1</code> å¯è·å–åˆ—è¡¨æ‰€æœ‰å…ƒç´ <br>2. end åŒ…å«äº†è‡ªèº«</td>
</tr>
<tr>
<td><code>lindex key index</code></td>
<td></td>
<td></td>
<td>è·å–åˆ—è¡¨æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ </td>
<td>$O(n)$ï¼Œğ‘› æ˜¯ç´¢å¼•çš„åç§»é‡</td>
<td></td>
</tr>
<tr>
<td><code>llen key</code></td>
<td></td>
<td>int</td>
<td>è·å–åˆ—è¡¨é•¿åº¦</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>lrem key count value</code></td>
<td></td>
<td>count &gt; 0ï¼Œä»å·¦åˆ°å³ï¼Œåˆ é™¤æœ€å¤š count ä¸ªå…ƒç´ <br>count &lt; 0ï¼Œä»å³åˆ°å·¦ï¼Œåˆ é™¤æœ€å¤š count ç»å¯¹å€¼ä¸ªå…ƒç´ <br>count = 0ï¼Œåˆ é™¤æ‰€æœ‰</td>
<td>åˆ é™¤æŒ‡å®šå…ƒç´ </td>
<td>$O(n)$ï¼Œğ‘› æ˜¯åˆ—è¡¨é•¿åº¦</td>
<td></td>
</tr>
<tr>
<td><code>ltrim key start end</code></td>
<td></td>
<td></td>
<td>æŒ‰ç…§ç´¢å¼•èŒƒå›´ä¿®å‰ªåˆ—è¡¨</td>
<td>$O(n)$ï¼Œğ‘› æ˜¯è¦è£å‰ªçš„å…ƒç´ æ€»æ•°</td>
<td></td>
</tr>
<tr>
<td><code>lset key index newValue</code></td>
<td></td>
<td></td>
<td>ä¿®æ”¹æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ </td>
<td>$O(n)$ï¼Œğ‘› æ˜¯ç´¢å¼•çš„åç§»é‡</td>
<td></td>
</tr>
<tr>
<td><code>blpop key [key ...] timeout</code><br><code>brpop key [key ...] timeout</code></td>
<td><code>timeout</code> ä¸ºé˜»å¡æ—¶é—´</td>
<td></td>
<td>é˜»å¡å¼å¼¹å‡º</td>
<td>$O(1)$</td>
<td>å¦‚æœæœ‰å¤šä¸ªé”®ï¼Œé‚£ä¹ˆ<code>brpop</code>ä¼šä»å·¦è‡³å³éå†é”®ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªé”®èƒ½å¼¹å‡ºå…ƒç´ ï¼Œå®¢æˆ·ç«¯ç«‹å³è¿”å›</td>
</tr>
<tr>
<td><strong>é›†åˆ(Set)</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>sadd key element [element ...]</code></td>
<td></td>
<td>intï¼ˆè¿”å›æ·»åŠ æˆåŠŸå…ƒç´ çš„ä¸ªæ•°ï¼‰</td>
<td>æ·»åŠ å…ƒç´ </td>
<td>$O(k)$ï¼Œğ‘˜æ˜¯å…ƒç´ ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>srem key element [element ...]</code></td>
<td></td>
<td>intï¼ˆè¿”å›åˆ é™¤æˆåŠŸå…ƒç´ çš„ä¸ªæ•°ï¼‰</td>
<td>åˆ é™¤å…ƒç´ </td>
<td>$O(k)$ï¼Œğ‘˜æ˜¯å…ƒç´ ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>scard key</code></td>
<td></td>
<td></td>
<td>è®¡ç®—å…ƒç´ ä¸ªæ•°</td>
<td>$O(1)$</td>
<td>åŒ<code>dbsize</code>ç±»ä¼¼ï¼Œç›´æ¥è¯»å–å†…ç½®å˜é‡</td>
</tr>
<tr>
<td><code>sismember key element</code></td>
<td></td>
<td>intï¼ˆå­˜åœ¨è¿”å› 1ï¼Œå¦åˆ™ä¸º 0ï¼‰</td>
<td>åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>srandmember key [count]</code></td>
<td></td>
<td></td>
<td>éšæœºä»é›†åˆè¿”å›æŒ‡å®šä¸ªæ•°å…ƒç´ </td>
<td>$O(count)$</td>
<td></td>
</tr>
<tr>
<td><code>spop key</code></td>
<td></td>
<td></td>
<td>ä»é›†åˆéšæœºå¼¹å‡ºå…ƒç´ </td>
<td>$O(1)$</td>
<td><code>srandmember</code>å’Œ<code>spop</code>éƒ½æ˜¯éšæœºä»é›†åˆé€‰å‡ºå…ƒç´ ï¼Œä¸¤è€…ä¸åŒçš„æ˜¯<code>spop</code>å‘½ä»¤æ‰§è¡Œåï¼Œå…ƒç´ ä¼šä»é›†åˆä¸­åˆ é™¤ï¼Œè€Œ<code>srandmember</code>ä¸ä¼šã€‚</td>
</tr>
<tr>
<td><code>smembers key</code></td>
<td></td>
<td></td>
<td>è·å–æ‰€æœ‰å…ƒç´ ï¼Œç»“æœæ˜¯æ— åºçš„</td>
<td>$O(n)$ï¼Œğ‘›æ˜¯å…ƒç´ æ€»æ•°</td>
<td><code>smembers</code>å’Œ<code>lrange</code>ã€<code>hgetall</code>éƒ½å±äºæ¯”è¾ƒé‡çš„å‘½ä»¤ï¼Œå¦‚æœå…ƒç´ è¿‡å¤šå­˜åœ¨é˜»å¡Redisçš„å¯èƒ½æ€§ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨<code>sscan</code>æ¥å®Œæˆ</td>
</tr>
<tr>
<td><code>sinter key [key ...]</code></td>
<td></td>
<td></td>
<td>å–äº¤é›†</td>
<td>$O(m*k)$ï¼Œğ‘˜æ˜¯å¤šä¸ªé›†åˆå…ƒç´ æœ€å°‘çš„ä¸ªæ•°ï¼Œğ‘šæ˜¯é”®ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>suinon key [key ...]</code></td>
<td></td>
<td></td>
<td>å–å¹¶é›†</td>
<td>$O(k)$ï¼Œğ‘˜æ˜¯å¤šä¸ªé›†åˆå…ƒç´ ä¸ªæ•°å’Œ</td>
<td></td>
</tr>
<tr>
<td><code>sdiff key [key ...]</code></td>
<td></td>
<td></td>
<td>å–å·®é›†</td>
<td>$O(k)$ï¼Œğ‘˜æ˜¯å¤šä¸ªé›†åˆå…ƒç´ ä¸ªæ•°å’Œ</td>
<td></td>
</tr>
<tr>
<td><code>sinterstore destination key [key ...]</code><br><code>suionstore destination key [key ...]</code><br><code>sdiffstore destination key [key ...]</code></td>
<td></td>
<td></td>
<td>ï¼‰å°†äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„ç»“æœä¿å­˜</td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>æœ‰åºé›†åˆï¼ˆZsetï¼‰</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>zadd key score member [score member ...]</code></td>
<td></td>
<td></td>
<td>æ·»åŠ æˆå‘˜</td>
<td>$O(k*log(n))$ï¼Œğ‘˜æ˜¯æ·»åŠ æˆå‘˜çš„ä¸ªæ•°ï¼Œğ‘›æ˜¯å½“å‰æœ‰åºé›†åˆæˆå‘˜ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>zcard key</code></td>
<td></td>
<td>int</td>
<td>è®¡ç®—æˆå‘˜ä¸ªæ•°</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>zscore key member</code></td>
<td></td>
<td>intï¼ˆæˆå‘˜ä¸å­˜åœ¨è¿”å› nilï¼‰</td>
<td>è®¡ç®—æŸä¸ªæˆå‘˜çš„åˆ†æ•°</td>
<td>$O(1)$</td>
<td></td>
</tr>
<tr>
<td><code>zrank key member</code><br><code>zrevrank key member</code></td>
<td></td>
<td>è¿”å›åˆ†æ•°ä»ä½åˆ°é«˜/ä»é«˜åˆ°ä½çš„æ’å</td>
<td>è®¡ç®—æˆå‘˜çš„æ’å</td>
<td>$O(log(n))$ï¼Œğ‘›æ˜¯å½“å‰æœ‰åºé›†åˆæˆå‘˜ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>zrem key member [member ...]</code></td>
<td></td>
<td>è¿”å›åˆ é™¤æˆå‘˜çš„ä¸ªæ•°</td>
<td>åˆ é™¤æˆå‘˜</td>
<td>$O(k*log(n))$ï¼Œğ‘˜æ˜¯åˆ é™¤æˆå‘˜çš„ä¸ªæ•°ï¼Œğ‘›æ˜¯å½“å‰æœ‰åºé›†åˆæˆå‘˜ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>zincrby key increment member</code></td>
<td></td>
<td></td>
<td>å¢åŠ æˆå‘˜çš„åˆ†æ•°</td>
<td>$O(log(n))$ï¼Œğ‘›æ˜¯å½“å‰æœ‰åºé›†åˆæˆå‘˜ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>zrange key start end [withscores]</code><br><code>zrevrange key start end [withscores]</code></td>
<td><code>withscores</code>ä¼šåŒæ—¶è¿”å›æˆå‘˜åˆ†æ•°</td>
<td>è¿”å›åˆ†æ•°ä»ä½åˆ°é«˜/ä»é«˜åˆ°ä½çš„æ’å</td>
<td>è¿”å›æŒ‡å®šæ’åèŒƒå›´çš„æˆå‘˜</td>
<td>$O(log(n)+k)$ï¼Œğ‘˜æ˜¯è¦è·å–çš„æˆå‘˜ä¸ªæ•°ï¼Œğ‘›æ˜¯å½“å‰æœ‰åºé›†åˆæˆå‘˜ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>zrangebyscore key min max [withscores] [limit offset count]</code><br><code>zrevrangebyscore key max min [withscores] [limit offset count]</code></td>
<td><code>min</code>å’Œ<code>max</code>è¿˜æ”¯æŒå¼€åŒºé—´ï¼ˆå°æ‹¬å·ï¼‰å’Œé—­åŒºé—´ï¼ˆä¸­æ‹¬å·ï¼‰ï¼Œ<code>-inf</code>å’Œ<code>+inf</code>åˆ†åˆ«ä»£è¡¨æ— é™å°å’Œæ— é™å¤§</td>
<td></td>
<td>è¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜</td>
<td>$O(log(n)+k)$ï¼Œğ‘˜æ˜¯è¦è·å–çš„æˆå‘˜ä¸ªæ•°ï¼Œğ‘›æ˜¯å½“å‰æœ‰åºé›†åˆæˆå‘˜ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>zcount key min max</code></td>
<td></td>
<td></td>
<td>è¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´æˆå‘˜ä¸ªæ•°</td>
<td>$O(log(n))$ï¼Œğ‘›æ˜¯å½“å‰æœ‰åºé›†åˆæˆå‘˜ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>zremrangebyrank key start end</code></td>
<td></td>
<td></td>
<td>åˆ é™¤æŒ‡å®šæ’åå†…çš„å‡åºå…ƒç´ </td>
<td>$O(log(n)+k)$ï¼Œğ‘˜æ˜¯è¦åˆ é™¤çš„æˆå‘˜ä¸ªæ•°ï¼Œğ‘›æ˜¯å½“å‰æœ‰åºé›†åˆæˆå‘˜ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>zremrangebyscore key min max</code></td>
<td></td>
<td></td>
<td>åˆ é™¤æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜</td>
<td>$O(log(n)+k)$ï¼Œğ‘˜æ˜¯è¦åˆ é™¤çš„æˆå‘˜ä¸ªæ•°ï¼Œğ‘›æ˜¯å½“å‰æœ‰åºé›†åˆæˆå‘˜ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>zinterstore destination numkeys key [key ...] [weights weight [weight ...]] [aggregate sum|min|max]</code></td>
<td><code>destination</code>ï¼šäº¤é›†è®¡ç®—ç»“æœä¿å­˜åˆ°è¿™ä¸ªé”®ï¼›<br><code>numkeys</code>ï¼šéœ€è¦åšäº¤é›†è®¡ç®—é”®çš„ä¸ªæ•°ï¼›<br><code>key [key...]</code>ï¼šéœ€è¦åšäº¤é›†è®¡ç®—çš„é”®ï¼›<br><code>weights weight[weight...]</code>ï¼šæ¯ä¸ªé”®çš„æƒé‡ï¼Œåœ¨åšäº¤é›†è®¡ç®—æ—¶ï¼Œæ¯ä¸ªé”®ä¸­çš„æ¯ä¸ª member ä¼šå°†è‡ªå·±åˆ†æ•°ä¹˜ä»¥è¿™ä¸ªæƒé‡ï¼Œæ¯ä¸ªé”®çš„æƒé‡é»˜è®¤æ˜¯1ï¼›<br><code>aggregate sum|min|max</code>ï¼šè®¡ç®—æˆå‘˜äº¤é›†åï¼Œåˆ†å€¼å¯ä»¥æŒ‰ç…§sumï¼ˆå’Œï¼‰ã€minï¼ˆæœ€å°å€¼ï¼‰ã€maxï¼ˆæœ€å¤§å€¼ï¼‰åšæ±‡æ€»ï¼Œé»˜è®¤å€¼æ˜¯sum</td>
<td></td>
<td>å–äº¤é›†</td>
<td>$O(n * k)+O(m*log(m))$ï¼Œğ‘›æ˜¯æˆå‘˜æ•°æœ€å°çš„æœ‰åºé›†åˆæˆå‘˜ä¸ªæ•°ï¼Œğ‘˜æ˜¯æœ‰åºé›†åˆçš„ä¸ªæ•°ï¼Œğ‘šæ˜¯ç»“æœé›†ä¸­æˆå‘˜ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>zunionstore destination numkeys key [key ...] [weights weight [weight ...]] [aggregate sum|min|max]</code></td>
<td></td>
<td></td>
<td>å–å¹¶é›†</td>
<td>$O(n)+O(m*log(m))$ï¼Œğ‘›æ˜¯æ‰€æœ‰æœ‰åºé›†åˆæˆå‘˜ä¸ªæ•°å’Œï¼Œğ‘šæ˜¯ç»“æœé›†ä¸­æˆå‘˜ä¸ªæ•°</td>
<td></td>
</tr>
</tbody></table>
<h2 id="åˆ¤æ–­é”®ä¸å­˜åœ¨çš„æ–¹æ³•ï¼š"><a href="#åˆ¤æ–­é”®ä¸å­˜åœ¨çš„æ–¹æ³•ï¼š" class="headerlink" title="åˆ¤æ–­é”®ä¸å­˜åœ¨çš„æ–¹æ³•ï¼š"></a>åˆ¤æ–­é”®ä¸å­˜åœ¨çš„æ–¹æ³•ï¼š</h2><ol>
<li><code>exists</code> è¿”å› 0</li>
<li><code>del</code> è¿”å› 0</li>
<li><code>ttl</code> è¿”å› -2</li>
<li><code>type</code> è¿”å› <code>none</code></li>
<li><code>get</code> è¿”å› <code>nil</code></li>
</ol>
<p>è®¾è®¡åˆç†çš„é”®åï¼Œæœ‰åŠ©äºé˜²æ­¢é”®å†²çªå’Œé¡¹ç›®çš„å¯ç»´æŠ¤æ€§ï¼Œæ¯”è¾ƒæ¨èçš„æ–¹å¼æ˜¯ä½¿ç”¨â€œä¸šåŠ¡åï¼šå¯¹è±¡åï¼šidï¼š[å±æ€§]â€ä½œä¸ºé”®åã€‚å¦‚æœé”®åè¾ƒé•¿ï¼Œå¯ä»¥åœ¨èƒ½æè¿°é”®å«ä¹‰çš„å‰æä¸‹é€‚å½“å‡å°‘é”®çš„é•¿åº¦ï¼Œä»è€Œå‡å°‘ç”±äºé”®åè¿‡é•¿è€Œå¯¼è‡´çš„å†…å­˜æµªè´¹ã€‚</p>
<h2 id="åˆ—è¡¨çš„å››ç§æ“ä½œç±»å‹"><a href="#åˆ—è¡¨çš„å››ç§æ“ä½œç±»å‹" class="headerlink" title="åˆ—è¡¨çš„å››ç§æ“ä½œç±»å‹"></a>åˆ—è¡¨çš„å››ç§æ“ä½œç±»å‹</h2><table>
<thead>
<tr>
<th>æ“ä½œç±»å‹</th>
<th>æ“ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td>æ·»åŠ </td>
<td><code>rpush</code> <code>lpush</code> <code>linsert</code></td>
</tr>
<tr>
<td>æŸ¥</td>
<td><code>lrange</code> <code>lindex</code> <code>llen</code></td>
</tr>
<tr>
<td>åˆ é™¤</td>
<td><code>lpop</code> <code>rpop</code> <code>lrem</code> <code>ltrim</code></td>
</tr>
<tr>
<td>ä¿®æ”¹</td>
<td><code>lset</code></td>
</tr>
<tr>
<td>é˜»å¡æ“ä½œ</td>
<td><code>blpop</code> <code>brpop</code></td>
</tr>
</tbody></table>
<h2 id="åˆ—è¡¨çš„ä½¿ç”¨åœºæ™¯ï¼š"><a href="#åˆ—è¡¨çš„ä½¿ç”¨åœºæ™¯ï¼š" class="headerlink" title="åˆ—è¡¨çš„ä½¿ç”¨åœºæ™¯ï¼š"></a>åˆ—è¡¨çš„ä½¿ç”¨åœºæ™¯ï¼š</h2><ul>
<li><code>lpush</code> + <code>lpop</code> = Stackï¼ˆæ ˆï¼‰</li>
<li><code>lpush</code> + <code>rpop</code> = Queueï¼ˆé˜Ÿåˆ—ï¼‰</li>
<li><code>lpush</code> + <code>ltrim</code> = Capped Collectionï¼ˆæœ‰é™é›†åˆï¼‰</li>
<li><code>lpush</code> + <code>brpop</code> = Message Queueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰</li>
</ul>
<h2 id="é›†åˆçš„ä½¿ç”¨åœºæ™¯"><a href="#é›†åˆçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="é›†åˆçš„ä½¿ç”¨åœºæ™¯"></a>é›†åˆçš„ä½¿ç”¨åœºæ™¯</h2><ul>
<li><code>sadd</code> = Taggingï¼ˆæ ‡ç­¾ï¼‰</li>
<li><code>spop/srandmember</code> = Random itemï¼ˆç”Ÿæˆéšæœºæ•°ï¼Œæ¯”å¦‚æŠ½å¥–ï¼‰</li>
<li><code>sadd</code> + <code>sinter</code>= Social Graphï¼ˆç¤¾äº¤éœ€æ±‚ï¼‰</li>
</ul>
<h2 id="åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆçš„å¼‚åŒç‚¹"><a href="#åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆçš„å¼‚åŒç‚¹" class="headerlink" title="åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆçš„å¼‚åŒç‚¹"></a>åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆçš„å¼‚åŒç‚¹</h2><table>
<thead>
<tr>
<th>æ•°æ®ç»“æ„</th>
<th align="center">æ˜¯å¦å…è®¸é‡å¤å…ƒç´ </th>
<th align="center">æ˜¯å¦æœ‰åº</th>
<th>æœ‰åºå®ç°æ–¹å¼</th>
<th>åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>åˆ—è¡¨</td>
<td align="center">æ˜¯</td>
<td align="center">æ˜¯</td>
<td>ç´¢å¼•ä¸‹æ ‡</td>
<td>æ—¶é—´è½´ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰</td>
</tr>
<tr>
<td>é›†åˆ</td>
<td align="center">å¦</td>
<td align="center">å¦</td>
<td>æ— </td>
<td>æ ‡ç­¾ã€ç¤¾äº¤ç­‰</td>
</tr>
<tr>
<td>æœ‰åºé›†åˆ</td>
<td align="center">å¦</td>
<td align="center">æ˜¯</td>
<td>åˆ†å€¼</td>
<td>æ’è¡Œæ¦œã€ç¤¾äº¤ç­‰</td>
</tr>
</tbody></table>
<h2 id="Redis-æ•°æ®ç»“æ„ä¸å†…éƒ¨ç¼–ç "><a href="#Redis-æ•°æ®ç»“æ„ä¸å†…éƒ¨ç¼–ç " class="headerlink" title="Redis æ•°æ®ç»“æ„ä¸å†…éƒ¨ç¼–ç "></a>Redis æ•°æ®ç»“æ„ä¸å†…éƒ¨ç¼–ç </h2><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8rmou0bzdj30hx0kb0xe.jpg" alt="Redisæ•°æ®ç»“æ„ä¸å†…éƒ¨ç¼–ç "></p>
<ul>
<li>å­—ç¬¦ä¸²<ul>
<li>int: 8ä¸ªå­—èŠ‚çš„é•¿æ•´å‹</li>
<li>embstr: &lt;=39 Byte çš„å­—ç¬¦ä¸²</li>
<li>raw: &gt;39 Byte çš„å­—ç¬¦ä¸²</li>
</ul>
</li>
<li>å“ˆå¸Œ<ul>
<li>ziplist: å½“å“ˆå¸Œç±»å‹å…ƒç´ ä¸ªæ•°å°äº <code>hash-max-ziplist-entries</code> é…ç½®ï¼ˆé»˜è®¤512ä¸ªï¼‰ã€åŒæ—¶æ‰€æœ‰å€¼éƒ½å°äº <code>hash-max-ziplist-value</code> é…ç½®ï¼ˆé»˜è®¤64å­—èŠ‚ï¼‰æ—¶ï¼ŒRedis ä¼šä½¿ç”¨ ziplist ä½œä¸ºå“ˆå¸Œçš„å†…éƒ¨å®ç°ï¼Œziplist ä½¿ç”¨æ›´åŠ ç´§å‡‘çš„ç»“æ„å®ç°å¤šä¸ªå…ƒç´ çš„è¿ç»­å­˜å‚¨ï¼Œæ‰€ä»¥åœ¨<strong>èŠ‚çœå†…å­˜æ–¹é¢æ¯” hashtable æ›´åŠ ä¼˜ç§€</strong>ã€‚</li>
<li>hashtable: å½“å“ˆå¸Œç±»å‹æ— æ³•æ»¡è¶³ ziplist çš„æ¡ä»¶æ—¶ï¼ŒRedis ä¼šä½¿ç”¨ hashtable ä½œä¸ºå“ˆå¸Œçš„å†…éƒ¨å®ç°ï¼Œå› ä¸ºæ­¤æ—¶ ziplist çš„è¯»å†™æ•ˆç‡ä¼šä¸‹é™ï¼Œè€Œ hashtable çš„è¯»å†™æ—¶é—´å¤æ‚åº¦ä¸º$O(1)$</li>
</ul>
</li>
<li>åˆ—è¡¨<ul>
<li>ziplist: å½“åˆ—è¡¨å…ƒç´ ä¸ªæ•°å°äº <code>list-max-ziplist-entries</code> é…ç½®ï¼ˆé»˜è®¤512ä¸ªï¼‰ã€åŒæ—¶æ¯ä¸ªå…ƒç´ å€¼éƒ½å°äº <code>list-max-ziplist-value</code> é…ç½®ï¼ˆé»˜è®¤64å­—èŠ‚ï¼‰æ—¶ï¼ŒRedis ä¼šä½¿ç”¨ ziplist æ¥ä½œä¸ºåˆ—è¡¨çš„å†…éƒ¨å®ç°æ¥å‡å°‘å†…å­˜</li>
<li>linkedlist: å½“æ— æ³•æ»¡è¶³ziplistæ¡ä»¶æ—¶</li>
</ul>
</li>
<li>é›†åˆ<ul>
<li>intset: å½“é›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°ä¸”å…ƒç´ ä¸ªæ•°å°äº<code>set-maxintset-entries</code>é…ç½®ï¼ˆé»˜è®¤512ä¸ªï¼‰æ—¶ï¼ŒRedisä¼šé€‰ç”¨intsetæ¥ä½œä¸ºé›†åˆçš„å†…éƒ¨å®ç°ï¼Œä»è€Œå‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚</li>
<li>hashtable: æ— æ³•æ»¡è¶³intsetæ—¶</li>
</ul>
</li>
<li>æœ‰åºé›†åˆ<ul>
<li>ziplist: å½“æœ‰åºé›†åˆçš„å…ƒç´ ä¸ªæ•°å°äº<code>zset-max-ziplistentries</code>é…ç½®ï¼ˆé»˜è®¤128ä¸ªï¼‰ï¼ŒåŒæ—¶æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äº<code>zset-max-ziplist-value</code>é…ç½®ï¼ˆé»˜è®¤64å­—èŠ‚ï¼‰æ—¶ï¼ŒRedisä¼šç”¨ziplistæ¥ä½œä¸ºæœ‰åºé›†åˆçš„å†…éƒ¨å®ç°æ¥å‡å°‘å†…å­˜</li>
<li>skiplist: å½“æ— æ³•æ»¡è¶³ziplistæ¡ä»¶æ—¶</li>
</ul>
</li>
</ul>
<p>Redis è®¾è®¡å†…éƒ¨ç¼–ç ä¸å¤–éƒ¨ç»“æ„æœ‰ä¸¤ä¸ªå¥½å¤„</p>
<ol>
<li>æ”¹è¿›å†…éƒ¨ç¼–ç è€Œå¯¹å¤–éƒ¨æ•°æ®ç»“æ„å’Œå‘½ä»¤æ²¡æœ‰å½±å“</li>
<li>å¤šç§å†…éƒ¨ç¼–ç å®ç°å¯ä»¥åœ¨ä¸åŒåœºæ™¯ä¸‹å‘æŒ¥å„è‡ªçš„ä¼˜åŠ¿ï¼Œå¦‚ ziplist æ¯”è¾ƒèŠ‚çœå†…å­˜ï¼Œä½†åœ¨åˆ—è¡¨å…ƒç´ è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œæ€§èƒ½ä¼šæœ‰æ‰€ä¸‹é™ï¼Œæ­¤æ—¶ Redis ä¼šæ ¹æ®é…ç½®é€‰é¡¹å°†åˆ—è¡¨ç±»å‹çš„å†…éƒ¨å®ç°è½¬æ¢ä¸º linkedlistã€‚</li>
</ol>
<p>å¯ä»¥é€šè¿‡<code>object encoding key</code>å‘½ä»¤æŸ¥è¯¢å†…éƒ¨ç¼–ç ã€‚</p>
<h1 id="ç¬¬-3-ç« -å°åŠŸèƒ½å¤§ç”¨å¤„"><a href="#ç¬¬-3-ç« -å°åŠŸèƒ½å¤§ç”¨å¤„" class="headerlink" title="ç¬¬ 3 ç«  å°åŠŸèƒ½å¤§ç”¨å¤„"></a>ç¬¬ 3 ç«  å°åŠŸèƒ½å¤§ç”¨å¤„</h1><h2 id="æ…¢æŸ¥è¯¢"><a href="#æ…¢æŸ¥è¯¢" class="headerlink" title="æ…¢æŸ¥è¯¢"></a>æ…¢æŸ¥è¯¢</h2><h3 id="æ…¢æŸ¥è¯¢é…ç½®"><a href="#æ…¢æŸ¥è¯¢é…ç½®" class="headerlink" title="æ…¢æŸ¥è¯¢é…ç½®"></a>æ…¢æŸ¥è¯¢é…ç½®</h3><ul>
<li><code>slowlog-log-slower-than</code> æ‰§è¡Œæ—¶é—´é˜ˆå€¼<ul>
<li>å•ä½ä¸ºå¾®ç§’ï¼Œé»˜è®¤ 10,000ï¼Œä¸º 0 è¡¨ç¤ºè®°å½•æ‰€æœ‰å‘½ä»¤ï¼Œ&lt;0 ä¸è®°å½•ä»»ä½•å‘½ä»¤</li>
<li>åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œéœ€è¦å°†è¯¥å€¼å‘ä¸‹è°ƒæ•´</li>
</ul>
</li>
<li><code>slowlog-max-len</code><ul>
<li>Redis ä½¿ç”¨åˆ—è¡¨ç»“æ„å­˜å‚¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè¯¥å‚æ•°ä¸ºåˆ—è¡¨æœ€å¤§é•¿åº¦</li>
<li>å½“åˆ—è¡¨è¾¾æœ€å¤§é•¿åº¦æ—¶ï¼Œæœ€æ—©æ’å…¥çš„å‘½ä»¤ä¼šè¢«ä»åˆ—è¡¨ä¸­ç§»å‡º</li>
<li>å¯å®šæ—¶å°†æ…¢æŸ¥è¯¢æ—¥å¿—æŒä¹…åŒ–å¤„ç†ï¼Œä¾¿äºæ’æŸ¥æ•…éšœ</li>
</ul>
</li>
</ul>
<h3 id="æ…¢æŸ¥è¯¢å‘½ä»¤"><a href="#æ…¢æŸ¥è¯¢å‘½ä»¤" class="headerlink" title="æ…¢æŸ¥è¯¢å‘½ä»¤"></a>æ…¢æŸ¥è¯¢å‘½ä»¤</h3><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>é€‰é¡¹</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>slowlog get [n]</code></td>
<td><code>n</code>: æŒ‡å®šæ¡æ•°</td>
<td></td>
</tr>
<tr>
<td><code>slowlog len</code></td>
<td></td>
<td>è·å–å½“å‰æ…¢æŸ¥è¯¢åˆ—è¡¨é•¿åº¦</td>
</tr>
<tr>
<td><code>slowlog reset</code></td>
<td></td>
<td>é‡ç½®æ—¥å¿—ï¼Œå³æ¸…ç†æ…¢æŸ¥è¯¢åˆ—è¡¨</td>
</tr>
</tbody></table>
<h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—ç»“æ„"><a href="#æ…¢æŸ¥è¯¢æ—¥å¿—ç»“æ„" class="headerlink" title="æ…¢æŸ¥è¯¢æ—¥å¿—ç»“æ„"></a>æ…¢æŸ¥è¯¢æ—¥å¿—ç»“æ„</h3><p>ç”± 4 ä¸ªå±æ€§ç»„æˆ</p>
<ol>
<li>æ—¥å¿—æ ‡è¯† ID</li>
<li>æ—¶é—´æˆ³</li>
<li>å‘½ä»¤è€—æ—¶</li>
<li>æ‰§è¡Œå‘½ä»¤å’Œå‚æ•°<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; slowlog get</span><br><span class="line">1) 1) (integer) 666</span><br><span class="line">   2) (integer) 1456786500</span><br><span class="line">   3) (integer) 11615</span><br><span class="line">   4) 1) &quot;BGREWRITEAOF&quot;</span><br><span class="line">2) 1) (integer) 665</span><br><span class="line">   2) (integer) 1456718400</span><br><span class="line">   3) (integer) 12006</span><br><span class="line">   4) 1) &quot;SETEX&quot;</span><br><span class="line">      2) &quot;video_info_200&quot;</span><br><span class="line">      3) &quot;300&quot;</span><br><span class="line">      4) &quot;2&quot;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Redis-Shell"><a href="#Redis-Shell" class="headerlink" title="Redis Shell"></a>Redis Shell</h2><h3 id="redis-cli"><a href="#redis-cli" class="headerlink" title="redis-cli"></a><code>redis-cli</code></h3><table>
<thead>
<tr>
<th>ç¤ºä¾‹</th>
<th>é€‰é¡¹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>redis-cli -r 3 ping</code></td>
<td><code>-r</code>(repeat)ï¼šæŒ‡å®šå‘½ä»¤æ‰§è¡Œæ¬¡æ•°</td>
<td></td>
</tr>
<tr>
<td><code>redis-cli -r 5 -i 1 ping</code></td>
<td><code>-i</code>(interval)ï¼šæ‰§è¡Œå‘½ä»¤é—´éš”æ—¶é—´ï¼Œå•ä½ç§’</td>
<td><code>-i</code>å¿…é¡»ä¸<code>-r</code>ä¸€åŒä½¿ç”¨<br>è¯¥é€‰é¡¹ä¸æ”¯æŒæ¯«ç§’ä¸ºå•ä½ï¼Œè‹¥æƒ³ä»¥ 10ms ä¸ºé—´éš”ï¼Œå¯ä»¥ä½¿ç”¨<code>-i 0.01</code></td>
</tr>
<tr>
<td><code>echo &quot;world&quot; | redis-cli -x set hello</code></td>
<td><code>-x</code>: ä» stdin è¯»å–æ•°æ®ä½œä¸º <code>redis-cli</code>çš„æœ€åä¸€ä¸ªå‚æ•°</td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>-c</code>(cluster): è¿æ¥ Redis cluster æ—¶ä½¿ç”¨ï¼Œå¯ä»¥é˜²æ­¢ <code>moved</code> å’Œ <code>ask</code> å¼‚å¸¸</td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>-a</code>(auth): å¯†ç è®¤è¯</td>
<td></td>
</tr>
<tr>
<td><code>redis-cli --scan --pattern &quot;app*&quot;</code></td>
<td><code>--scan</code> &amp; <code>--pattern</code>: äºæ‰«ææŒ‡å®šæ¨¡å¼çš„é”®</td>
<td></td>
</tr>
<tr>
<td><code>redis-cli --slave</code></td>
<td><code>--slave</code>é€‰é¡¹æ˜¯æŠŠå½“å‰å®¢æˆ·ç«¯æ¨¡æ‹Ÿæˆå½“å‰ Redis èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼Œå¯ä»¥ç”¨æ¥è·å–å½“å‰ Redis èŠ‚ç‚¹çš„æ›´æ–°æ“ä½œ</td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>--rdb</code>: å°† Redis å®ä¾‹æŒä¹…åŒ–</td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>--pipe</code>: å°†å‘½ä»¤å°è£…æˆRedisé€šä¿¡åè®®å®šä¹‰çš„æ•°æ®æ ¼å¼ï¼Œæ‰¹é‡å‘é€ç»™Redisæ‰§è¡Œ</td>
<td></td>
</tr>
<tr>
<td><code>redis-cli --bigkeys</code></td>
<td><code>--bigkeys</code>: ä½¿ç”¨scanå‘½ä»¤å¯¹Redisçš„é”®è¿›è¡Œé‡‡æ ·ï¼Œä»ä¸­æ‰¾åˆ°å†…å­˜å ç”¨æ¯”è¾ƒå¤§çš„é”®å€¼ï¼Œè¿™äº›é”®å¯èƒ½æ˜¯ç³»ç»Ÿçš„ç“¶é¢ˆ</td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>--eval</code>: æŒ‡å®š Lua è„šæœ¬</td>
<td></td>
</tr>
<tr>
<td><code>redis-cli -h {machineB} --latency</code><br><code>redis-cli -h {machineB} --latency-history</code><br><code>redis-cli -h {machineB} --latency-dist</code></td>
<td><code>--latency</code>: æµ‹è¯•ç›®æ ‡ Redis ç½‘ç»œå»¶æ—¶ã€‚ä»…è¿”å›ä¸€æ¡ç»“æœ<br><code>--latency-history</code>: æ¯é—´éš”ä¸€å®šæ—¶é—´ï¼ˆå¯é€šè¿‡<code>-i</code>è®¾å®šï¼‰è¿”å›ç»“æœ<br><code>--latency-dist</code>: ä»¥ç»Ÿè®¡å›¾è¡¨çš„æ–¹å¼è¾“å‡ºç»Ÿè®¡ä¿¡æ¯</td>
<td></td>
</tr>
<tr>
<td><code>redis-cli --stat</code></td>
<td><code>--stat</code>: å®æ—¶è·å– Redis ç»Ÿè®¡ä¿¡æ¯</td>
<td><code>redis-cli info</code>ä¹Ÿèƒ½æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</td>
</tr>
<tr>
<td><code>redis-cli --no-raw get apple</code></td>
<td><code>--raw</code> &amp; <code>--no-raw</code>: æ˜¯å¦æ ¼å¼åŒ–è¾“å‡º</td>
<td></td>
</tr>
</tbody></table>
<h3 id="redis-server"><a href="#redis-server" class="headerlink" title="redis-server"></a><code>redis-server</code></h3><p><code>redis-server --test-memory 1024</code> å¯ç”¨äºæ£€æµ‹å½“å‰ OS æ˜¯å¦èƒ½ç¨³å®šåˆ†é…æŒ‡å®šå®¹é‡å†…å­˜ç»™ Redisï¼Œè¯¥å‘½ä»¤é€šå¸¸ç”¨äºå‹æµ‹ã€‚</p>
<h3 id="redis-benchmark"><a href="#redis-benchmark" class="headerlink" title="redis-benchmark"></a><code>redis-benchmark</code></h3><p>è¯¥å‘½ä»¤ä¼šå¯¹å„ç±»æ•°æ®ç»“æ„çš„å‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼Œå¹¶ç»™å‡ºæ€§èƒ½æŒ‡æ ‡ã€‚</p>
<ul>
<li><code>-c</code>(client) å¯æŒ‡å®šå®¢æˆ·ç«¯å¹¶å‘æ•°ï¼ˆé»˜è®¤ 50ï¼‰</li>
<li><code>-n</code> æŒ‡å®šå®¢æˆ·ç«¯è¯·æ±‚æ€»é‡ï¼ˆé»˜è®¤ 100,000ï¼‰</li>
<li><code>-q</code> ä»…æ˜¾ç¤ºæ¯ç§’æ¥æ”¶è¯·æ±‚æ•°</li>
<li><code>-r</code>(random) éšæœºæ’å…¥é”®ï¼Œä»¥è¿›è¡ŒåŸºå‡†æµ‹è¯•</li>
<li><code>-P</code> æ¯ä¸ªè¯·æ±‚ pipeline çš„æ•°æ®é‡ï¼ˆé»˜è®¤ä¸º 1ï¼‰</li>
<li><code>-k</code> å®¢æˆ·ç«¯æ˜¯å¦ä½¿ç”¨<code>keepalive</code>ï¼Œ1 ä¸ºä½¿ç”¨ï¼Œ0 ä¸ºä¸ä½¿ç”¨ï¼Œé»˜è®¤ä¸º 1</li>
<li><code>-t</code> å¯¹æŒ‡å®šå‘½ä»¤è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œå¦‚<code>redis-benchmark -t get,set -q</code></li>
<li><code>--csv</code> å°†ç»“æœæŒ‰ç…§ csv æ ¼å¼è¾“å‡º</li>
</ul>
<h2 id="Pipeline"><a href="#Pipeline" class="headerlink" title="Pipeline"></a>Pipeline</h2><p>ç”±äº Redis æ˜¯å•çº¿ç¨‹æœºåˆ¶ï¼Œå½“éœ€è¦æ‰§è¡Œå¤šæ¡å‘½ä»¤æ—¶ï¼Œç½‘ç»œ I/O æˆä¸ºäº†ç“¶é¢ˆï¼Œå› æ­¤ pipeline å¯å°†å¾…æ‰§è¡Œå‘½ä»¤â€œæ‰“åŒ…â€ï¼Œé€šè¿‡ä¸€æ¬¡å¾€è¿”å³å¯å®Œæˆã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœ pipeline æ•°æ®é‡è¿‡å¤§ï¼Œå°†ä¼šå¯¼è‡´ç½‘ç»œé˜»å¡ã€‚</p>
<h2 id="äº‹åŠ¡ä¸-Lua"><a href="#äº‹åŠ¡ä¸-Lua" class="headerlink" title="äº‹åŠ¡ä¸ Lua"></a>äº‹åŠ¡ä¸ Lua</h2><p>Redis ä¸­ï¼Œå°†ä¸€ç»„éœ€è¦ä¸€èµ·æ‰§è¡Œçš„äº‹åŠ¡å‘½ä»¤æ”¾åˆ°<code>multi</code>(å¼€å§‹)å’Œ<code>exec</code>(ç»“æŸ)ä¹‹é—´å³å¯ï¼Œå¦‚æœè¦åœæ­¢äº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨<code>discard</code>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRedis ä¸æ”¯æŒäº‹åŠ¡çš„å›æ»šæ“ä½œï¼Œä½†å¯ä»¥é€šè¿‡ Lua æ¥å®ç°å›æ»šã€‚</p>
<p>æœ‰äº›åº”ç”¨åœºæ™¯éœ€è¦åœ¨äº‹åŠ¡ä¹‹å‰ï¼Œç¡®ä¿äº‹åŠ¡ä¸­çš„<code>key</code>æ²¡æœ‰è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹è¿‡ï¼Œæ‰æ‰§è¡Œäº‹åŠ¡ï¼Œå¦åˆ™ä¸æ‰§è¡Œï¼ˆç±»ä¼¼ä¹è§‚é”ï¼‰ã€‚Redisæä¾›äº†<code>watch</code>å‘½ä»¤æ¥è§£å†³è¿™ç±»é—®é¢˜ã€‚</p>
<p>Lua çš„æ•°æ®ç±»å‹ï¼š</p>
<ol>
<li>booleans(å¸ƒå°”)</li>
<li>numbers(æ•°å€¼)</li>
<li>strings(å­—ç¬¦ä¸²)</li>
<li>tables(è¡¨æ ¼)</li>
</ol>
<h3 id="åœ¨-Redis-ä¸­æ‰§è¡Œ-Lua-çš„æ–¹æ³•"><a href="#åœ¨-Redis-ä¸­æ‰§è¡Œ-Lua-çš„æ–¹æ³•" class="headerlink" title="åœ¨ Redis ä¸­æ‰§è¡Œ Lua çš„æ–¹æ³•"></a>åœ¨ Redis ä¸­æ‰§è¡Œ Lua çš„æ–¹æ³•</h3><p>æ–¹å¼ä¸€<br><code>eval è„šæœ¬å†…å®¹ keyä¸ªæ•° keyåˆ—è¡¨ å‚æ•°åˆ—è¡¨</code></p>
<p>æ–¹å¼äºŒ<br>å…ˆå°† Lua è„šæœ¬åŠ è½½å…¥ Redisï¼Œå¾—åˆ°è¯¥è„šæœ¬çš„ SHA1ï¼Œ<code>evalsha</code>ä½¿ç”¨<code>SHA1</code>æ‰§è¡Œå¯¹åº”çš„è„šæœ¬ã€‚è¿™æ ·å¯ä»¥é‡å¤æ‰¹å¤„ç†ã€‚</p>
<ul>
<li>åŠ è½½è„šæœ¬ï¼š<code>redis-cli script load &quot;$(cat lua_get.lua)&quot;</code></li>
<li>æ‰§è¡Œè„šæœ¬ï¼š<code>evalsha è„šæœ¬SHA1å€¼ keyä¸ªæ•° keyåˆ—è¡¨ å‚æ•°åˆ—è¡¨</code></li>
<li>åˆ¤æ–­è„šæœ¬æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼š<code>scripts exists sha1 [sha1 â€¦]</code>ï¼Œè¿”å›å­˜åœ¨çš„è„šæœ¬ä¸ªæ•°</li>
<li>æ¸…é™¤æ‰€æœ‰è„šæœ¬ï¼š<code>script flush</code></li>
<li>å¼ºåˆ¶ç»ˆæ­¢è„šæœ¬ï¼š<code>script kill</code>ã€‚å¦‚æœå½“å‰è„šæœ¬æ­£åœ¨å†™å…¥ï¼Œåˆ™è¯¥å‘½ä»¤ä¸ä¼šç”Ÿæ•ˆï¼Œæ­¤æ—¶è¦ä¹ˆç­‰å¾…è„šæœ¬æ‰§è¡Œç»“æŸï¼Œè¦ä¹ˆä½¿ç”¨<code>shutdown save</code>åœæ­¢ Redis æœåŠ¡</li>
</ul>
<blockquote>
<p>Lua è„šæœ¬åœ¨ Redis ä¸­æ˜¯åŸå­æ‰§è¡Œçš„ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šæ’å…¥å…¶å®ƒå‘½ä»¤ã€‚</p>
</blockquote>
<h2 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h2><p>Bitmapsæœ¬èº«ä¸æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®é™…ä¸Šå®ƒå°±æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å®ƒå¯ä»¥å¯¹å­—ç¬¦ä¸²çš„ä½è¿›è¡Œæ“ä½œã€‚</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>setbit key offset value</code></td>
<td>è®¾ç½®å€¼</td>
<td>å¾ˆå¤šåº”ç”¨çš„ç”¨æˆ·idä»¥ä¸€ä¸ªæŒ‡å®šæ•°å­—ï¼ˆä¾‹å¦‚10000ï¼‰å¼€å¤´ï¼Œç›´æ¥å°†ç”¨æˆ·idå’ŒBitmapsçš„åç§»é‡å¯¹åº”åŠ¿å¿…ä¼šé€ æˆä¸€å®šçš„æµªè´¹ï¼Œé€šå¸¸çš„åšæ³•æ˜¯æ¯æ¬¡åš <code>setbit</code> æ“ä½œæ—¶å°†ç”¨æˆ·idå‡å»è¿™ä¸ªæŒ‡å®šæ•°å­—ã€‚åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ– Bitmaps æ—¶ï¼Œå‡å¦‚åç§»é‡éå¸¸å¤§ï¼Œé‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œä¼šæ¯”è¾ƒæ…¢ï¼Œå¯èƒ½ä¼šé€ æˆRedisçš„é˜»å¡</td>
</tr>
<tr>
<td><code>gitbit key offset</code></td>
<td>è·å–å€¼</td>
<td></td>
</tr>
<tr>
<td><code>bitcount key [start][end]</code></td>
<td>è·å–BitmapsæŒ‡å®šèŒƒå›´å€¼ä¸º1çš„ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>bitop operator destkey key[key....]</code></td>
<td>Bitmapsé—´çš„è¿ç®—</td>
<td><code>bitop</code>æ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼Œå®ƒå¯ä»¥åšå¤šä¸ªBitmapsçš„<code>and</code>ã€<code>or</code>ã€<code>not</code>ã€<code>xor</code>æ“ä½œå¹¶å°†ç»“æœä¿å­˜åœ¨<code>destkey</code>ä¸­</td>
</tr>
<tr>
<td><code>bitpos key targetBit [start] [end]</code></td>
<td>è®¡ç®—Bitmapsä¸­ç¬¬ä¸€ä¸ªå€¼ä¸ºtargetBitçš„åç§»é‡</td>
<td></td>
</tr>
</tbody></table>
<p>å½“ç”¨æˆ·é‡å¾ˆå¤§æ—¶ï¼Œä½¿ç”¨ bitmaps å­˜å‚¨ç”¨æˆ·çš„æ´»è·ƒæƒ…å†µæ˜¯éå¸¸å¥½çš„ä¸€ç§æ–¹æ¡ˆï¼Œä½†æ´»è·ƒç”¨æˆ·é‡è¾ƒå°‘æ—¶åˆ™ä¸åˆç†ï¼Œå¤§å¤šæ•°ä½éƒ½æ˜¯ 0ã€‚</p>
<h2 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h2><p>HyperLogLogå¹¶ä¸æ˜¯ä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼ˆå®é™…ç±»å‹ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼‰ï¼Œé€šè¿‡HyperLogLogå¯ä»¥åˆ©ç”¨æå°çš„å†…å­˜ç©ºé—´å®Œæˆç‹¬ç«‹æ€»æ•°çš„ç»Ÿè®¡ï¼Œæ•°æ®é›†å¯ä»¥æ˜¯IPã€Emailã€IDç­‰ã€‚</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>pfadd key element [element â€¦]</code></td>
<td>æ·»åŠ ï¼ŒæˆåŠŸè¿”å› 1</td>
<td></td>
</tr>
<tr>
<td><code>pfcount key [key â€¦]</code></td>
<td>è®¡ç®—ç‹¬ç«‹ç”¨æˆ·</td>
<td></td>
</tr>
<tr>
<td><code>pfmerge destkey sourcekey [sourcekey ...]</code></td>
<td>åˆå¹¶</td>
<td></td>
</tr>
</tbody></table>
<p>ç›¸æ¯”äºé›†åˆç±»å‹ï¼ŒHyperLogLog å†…å­˜å ç”¨é‡éå¸¸å°ï¼Œä½†æ˜¯å­˜åœ¨é”™è¯¯ç‡ï¼Œå› æ­¤ï¼Œåœ¨æ•°æ®ç»“æ„é€‰å‹æ—¶ï¼Œéœ€è¦å¹³è¡¡è¯¯å·®ä¸ç©ºé—´å ç”¨ç‡ã€‚</p>
<h2 id="å‘å¸ƒè®¢é˜…"><a href="#å‘å¸ƒè®¢é˜…" class="headerlink" title="å‘å¸ƒè®¢é˜…"></a>å‘å¸ƒè®¢é˜…</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>publish channel message</code></td>
<td>å‘å¸ƒæ¶ˆæ¯ï¼Œè¿”å›è®¢é˜…è€…ä¸ªæ•°</td>
<td></td>
</tr>
<tr>
<td><code>subscribe channel [channel ...]</code></td>
<td>è®¢é˜…æ¶ˆæ¯</td>
<td>å®¢æˆ·ç«¯åœ¨æ‰§è¡Œè®¢é˜…å‘½ä»¤ä¹‹åè¿›å…¥äº†è®¢é˜…çŠ¶æ€ï¼Œåªèƒ½æ¥æ”¶<code>subscribe</code>ã€<code>psubscribe</code>ã€<code>unsubscribe</code>ã€<code>punsubscribe</code>çš„å››ä¸ªå‘½ä»¤<br>æ–°å¼€å¯çš„è®¢é˜…å®¢æˆ·ç«¯ï¼Œæ— æ³•æ”¶åˆ°è¯¥é¢‘é“ä¹‹å‰çš„æ¶ˆæ¯ï¼Œå› ä¸ºRedisä¸ä¼šå¯¹å‘å¸ƒçš„æ¶ˆæ¯è¿›è¡ŒæŒä¹…åŒ–</td>
</tr>
<tr>
<td><code>unsubscribe [channel [channel ...]]</code></td>
<td>å–æ¶ˆè®¢é˜…</td>
<td></td>
</tr>
<tr>
<td><code>psubscribe pattern [pattern...]</code><br><code>punsubscribe [pattern [pattern ...]]</code></td>
<td>æŒ‰ç…§æ¨¡å¼è®¢é˜…å’Œå–æ¶ˆè®¢é˜…</td>
<td></td>
</tr>
<tr>
<td><code>pubsub channels [pattern]</code></td>
<td>æŸ¥çœ‹æ´»è·ƒçš„é¢‘é“</td>
<td></td>
</tr>
<tr>
<td><code>pubsub numsub [channel ...]</code></td>
<td>æŸ¥çœ‹é¢‘é“è®¢é˜…æ•°</td>
<td></td>
</tr>
<tr>
<td><code>pubsub numpat</code></td>
<td>æŸ¥çœ‹æ¨¡å¼è®¢é˜…æ•°</td>
<td></td>
</tr>
</tbody></table>
<h2 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h2><p>GEOåº•å±‚ç”± zset å®ç°ã€‚</p>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>geoadd key longitude latitude member [longitude latitude member ...]</code></td>
<td>å¢åŠ åœ°ç†ä½ç½®ä¿¡æ¯ã€‚è¿”å›æˆåŠŸæ·»åŠ çš„ä¸ªæ•°</td>
<td>æ›´æ–°åœ°ç†ä½ç½®ä¿¡æ¯ä»ç„¶å¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤ï¼Œä½†è¿”å›ä¸º 0ã€‚è¯¥å‘½ä»¤åŒæ—¶æ”¯æŒå¤šä¸ªåœ°ç†ä½ç½®æ·»åŠ </td>
</tr>
<tr>
<td><code>geopos key member [member ...]</code></td>
<td>è·å–åœ°ç†ä½ç½®ä¿¡æ¯</td>
<td></td>
</tr>
<tr>
<td><code>geodist key member1 member2 [unit]</code></td>
<td>è·å–ä¸¤ä¸ªåœ°ç†ä½ç½®çš„è·ç¦»</td>
<td><code>unit</code>ä¸ºå•ä½ï¼Œåˆ†åˆ«ä¸º<code>m</code>(ç±³)ï¼Œ<code>km</code>(å…¬é‡Œ)ï¼Œ<code>mi</code>(è‹±é‡Œ)ï¼Œ<code>ft</code>(å°º)</td>
</tr>
<tr>
<td><code>georadius key longitude latitude radiusm|km|ft|mi [withcoord] [withdist] [withhash] [COUNT count] [asc|desc] [store key] [storedist key]</code><br><br><code>georadiusbymember key member radiusm|km|ft|mi [withcoord] [withdist] [withhash] [COUNT count] [asc|desc] [store key] [storedist key]</code></td>
<td>è·å–æŒ‡å®šä½ç½®èŒƒå›´å†…çš„åœ°ç†ä¿¡æ¯ä½ç½®é›†åˆ</td>
<td><code>georadius</code>å’Œ<code>georadiusbymember</code>ä¸¤ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä»¥ä¸€ä¸ªåœ°ç†ä½ç½®ä¸ºä¸­å¿ƒç®—å‡ºæŒ‡å®šåŠå¾„å†…çš„å…¶ä»–åœ°ç†ä¿¡æ¯ä½ç½®ï¼Œä¸åŒçš„æ˜¯<code>georadius</code>å‘½ä»¤çš„ä¸­å¿ƒä½ç½®ç»™å‡ºäº†å…·ä½“çš„ç»çº¬åº¦ï¼Œ<code>georadiusbymember</code>åªéœ€ç»™å‡ºæˆå‘˜å³å¯ã€‚å…¶ä¸­<code>radiusm|km|ft|mi</code>æ˜¯å¿…éœ€å‚æ•°ï¼ŒæŒ‡å®šäº†åŠå¾„<br><code>withcoord</code>:è¿”å›ç»çº¬åº¦ï¼›<br><code>withdist</code>:è¿”å›ç¦»ä¸­å¿ƒèŠ‚ç‚¹ä½ç½®çš„è·ç¦»ï¼›<br><code>withhash</code>:è¿”å›<code>geohash</code>ï¼›<br><code>COUNT count</code>:è¿”å›æŒ‡å®šç»“æœæ•°é‡ï¼›<br><code>asc|desc</code>:æŒ‰è·ä¸­å¿ƒèŠ‚ç‚¹è·ç¦»å‡åºæˆ–é™åºï¼›<br><code>store key</code>:å°†ç»“æœä¿å­˜åˆ°æŒ‡å®šé”®ï¼›<br><code>storedist key</code>:å°†è·ä¸­å¿ƒèŠ‚ç‚¹è·ç¦»ä¿å­˜åˆ°æŒ‡å®šé”®</td>
</tr>
<tr>
<td><code>geohash key member [member ...]</code></td>
<td>è·å–geohash</td>
<td>Rediså°†æ‰€æœ‰åœ°ç†ä½ç½®ä¿¡æ¯çš„<code>geohash</code>å­˜æ”¾åœ¨<code>zset</code>ä¸­ï¼Œå­—ç¬¦ä¸²è¶Šé•¿ï¼Œè¡¨ç¤ºçš„ä½ç½®æ›´ç²¾ç¡®</td>
</tr>
<tr>
<td><code>zrem key member</code></td>
<td>åˆ é™¤åœ°ç†ä½ç½®ä¿¡æ¯</td>
<td></td>
</tr>
</tbody></table>
<h1 id="ç¬¬-4-ç« -å®¢æˆ·ç«¯"><a href="#ç¬¬-4-ç« -å®¢æˆ·ç«¯" class="headerlink" title="ç¬¬ 4 ç«  å®¢æˆ·ç«¯"></a>ç¬¬ 4 ç«  å®¢æˆ·ç«¯</h1><h2 id="å®¢æˆ·ç«¯å¸¸è§å¼‚å¸¸"><a href="#å®¢æˆ·ç«¯å¸¸è§å¼‚å¸¸" class="headerlink" title="å®¢æˆ·ç«¯å¸¸è§å¼‚å¸¸"></a>å®¢æˆ·ç«¯å¸¸è§å¼‚å¸¸</h2><ol>
<li>æ— æ³•ä»è¿æ¥æ± è·å–åˆ°è¿æ¥<ol>
<li>è¿æ¥æ± è®¾ç½®è¿‡å°ï¼Œé»˜è®¤ä¸º 8</li>
<li>å®¢æˆ·ç«¯æœªæ­£ç¡®ä½¿ç”¨è¿æ¥æ± ï¼Œå¦‚æ²¡æœ‰è¿›è¡Œé‡Šæ”¾</li>
<li>å­˜åœ¨æ…¢æŸ¥è¯¢æ“ä½œ</li>
<li>Redis æœåŠ¡é€ æˆå‘½ä»¤æ‰§è¡Œè¿‡ç¨‹é˜»å¡</li>
</ol>
</li>
<li>å®¢æˆ·ç«¯è¯»å†™è¶…æ—¶<ol>
<li>è¯»å†™æ—¶é—´è®¾ç½®è¿‡çŸ­</li>
<li>å‘½ä»¤æ‰§è¡Œæ—¶é—´è¾ƒé•¿</li>
<li>ç½‘è·¯å¼‚å¸¸</li>
<li>Redis è‡ªèº«å‘ç”Ÿé˜»å¡</li>
</ol>
</li>
<li>å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶<ol>
<li>è¶…æ—¶æ—¶é—´è¿‡çŸ­</li>
<li>Redis å‘ç”Ÿé˜»å¡ï¼Œ<code>tcp-backlog</code>å·²æ»¡ï¼Œé€ æˆæ–°çš„è¿æ¥å¤±è´¥</li>
<li>ç½‘ç»œå¼‚å¸¸</li>
</ol>
</li>
<li>å®¢æˆ·ç«¯ç¼“å†²åŒºå¼‚å¸¸<ol>
<li>è¾“å‡ºç¼“å†²åŒºæ»¡</li>
<li>é•¿æ—¶é—´é—²ç½®è¿æ¥è¢«æœåŠ¡ç«¯ä¸»åŠ¨æ–­å¼€</li>
<li>ä¸æ­£å¸¸å¹¶å‘è¯»å†™</li>
</ol>
</li>
<li>Lua è„šæœ¬æ­£åœ¨æ‰§è¡Œ<ol>
<li>è„šæœ¬æ­£åœ¨æ‰§è¡Œï¼Œä¸”æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†<code>lua-time-limit</code>ï¼Œéœ€ç­‰å¾…è„šæœ¬æ‰§è¡Œå®Œæˆï¼Œæˆ–è€…ä½¿ç”¨<code>shutdown save</code>å…³é—­ Redis æœåŠ¡</li>
</ol>
</li>
<li>Redis æ­£åœ¨åŠ è½½æŒä¹…åŒ–æ–‡ä»¶</li>
<li>Redis ä½¿ç”¨çš„å†…å­˜è¶…è¿‡<code>maxmemory</code>é…ç½®</li>
<li>å®¢æˆ·ç«¯è¿æ¥æ•°è¿‡å¤§<ol>
<li>å®¢æˆ·ç«¯ï¼šå¦‚æœ<code>maxclients</code>å‚æ•°ä¸æ˜¯å¾ˆå°çš„è¯ï¼Œåº”ç”¨æ–¹çš„å®¢æˆ·ç«¯è¿æ¥æ•°åŸºæœ¬ä¸ä¼šè¶…è¿‡<code>maxclients</code>ï¼Œé€šå¸¸æ¥çœ‹æ˜¯ç”±äºåº”ç”¨æ–¹å¯¹äºRediså®¢æˆ·ç«¯ä½¿ç”¨ä¸å½“é€ æˆçš„ã€‚æ­¤æ—¶å¦‚æœåº”ç”¨æ–¹æ˜¯åˆ†å¸ƒå¼ç»“æ„çš„è¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹çº¿éƒ¨åˆ†åº”ç”¨èŠ‚ç‚¹ï¼ˆä¾‹å¦‚å ç”¨è¿æ¥è¾ƒå¤šçš„èŠ‚ç‚¹ï¼‰ï¼Œä½¿å¾—Redisçš„è¿æ¥æ•°å…ˆé™ä¸‹æ¥ã€‚ä»è€Œè®©ç»å¤§éƒ¨åˆ†èŠ‚ç‚¹å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œæ­¤æ—¶å†é€šè¿‡æŸ¥æ‰¾ç¨‹åºbugæˆ–è€…è°ƒæ•´<code>maxclients</code>è¿›è¡Œé—®é¢˜çš„ä¿®å¤ã€‚</li>
<li>æœåŠ¡ç«¯ï¼šå¦‚æœæ­¤æ—¶å®¢æˆ·ç«¯æ— æ³•å¤„ç†ï¼Œè€Œå½“å‰Redisä¸ºé«˜å¯ç”¨æ¨¡å¼ï¼ˆä¾‹å¦‚Redis Sentinelå’ŒRedis Clusterï¼‰ï¼Œå¯ä»¥è€ƒè™‘å°†å½“å‰Redisåšæ•…éšœè½¬ç§»ã€‚</li>
</ol>
</li>
</ol>
<h2 id="å®¢æˆ·ç«¯æ¡ˆä¾‹åˆ†æ"><a href="#å®¢æˆ·ç«¯æ¡ˆä¾‹åˆ†æ" class="headerlink" title="å®¢æˆ·ç«¯æ¡ˆä¾‹åˆ†æ"></a>å®¢æˆ·ç«¯æ¡ˆä¾‹åˆ†æ</h2><h3 id="Rediså†…å­˜é™¡å¢"><a href="#Rediså†…å­˜é™¡å¢" class="headerlink" title="Rediså†…å­˜é™¡å¢"></a>Rediså†…å­˜é™¡å¢</h3><h4 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h4><p>æœåŠ¡ç«¯ç°è±¡ï¼šRedisä¸»èŠ‚ç‚¹å†…å­˜é™¡å¢ï¼Œå‡ ä¹ç”¨æ»¡<code>maxmemory</code>ï¼Œè€Œä»èŠ‚ç‚¹å†…å­˜å¹¶æ²¡æœ‰å˜åŒ–<br>å®¢æˆ·ç«¯ç°è±¡ï¼šå®¢æˆ·ç«¯äº§ç”Ÿäº†OOMå¼‚å¸¸ï¼Œæ— æ³•å†™å…¥æ–°çš„æ•°æ®</p>
<h4 id="åˆ†æåŸå› "><a href="#åˆ†æåŸå› " class="headerlink" title="åˆ†æåŸå› "></a>åˆ†æåŸå› </h4><p>ä»ç°è±¡çœ‹ï¼Œå¯èƒ½çš„åŸå› æœ‰ä¸¤ä¸ª</p>
<ol>
<li>ç¡®å®æœ‰å¤§é‡å†™å…¥ï¼Œä½†æ˜¯ä¸»ä»å¤åˆ¶å‡ºç°é—®é¢˜ï¼šç”¨<code>dbsize</code>æŸ¥è¯¢Rediså¤åˆ¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¤åˆ¶æ˜¯æ­£å¸¸çš„ï¼Œä¸»ä»æ•°æ®åŸºæœ¬ä¸€è‡´ã€‚</li>
<li>å…¶ä»–åŸå› é€ æˆä¸»èŠ‚ç‚¹å†…å­˜ä½¿ç”¨è¿‡å¤§ï¼šæ’æŸ¥æ˜¯å¦ç”±å®¢æˆ·ç«¯ç¼“å†²åŒºé€ æˆä¸»èŠ‚ç‚¹å†…å­˜é™¡å¢ï¼Œä½¿ç”¨<code>info clients</code>å‘½ä»¤æŸ¥è¯¢ï¼Œå‘ç°è¾“å‡ºç¼“å†²åŒºä¸å¤ªæ­£å¸¸ï¼Œè¿›ä¸€æ­¥é€šè¿‡<code>client list</code>å‘½ä»¤æ‰¾åˆ°<code>omem</code>ä¸æ­£å¸¸çš„è¿æ¥ï¼Œä¸€èˆ¬æ¥è¯´å¤§éƒ¨åˆ†å®¢æˆ·ç«¯çš„<code>omem</code>ä¸º0ï¼ˆå› ä¸ºå¤„ç†é€Ÿåº¦ä¼šè¶³å¤Ÿå¿«ï¼‰ï¼Œäºæ˜¯é€šè¿‡<code>redis-cli client list | grep -v &quot;omem=0&quot;</code>æ‰¾åˆ°<code>omem</code>éé›¶çš„å®¢æˆ·ç«¯è¿æ¥ã€‚</li>
</ol>
<h3 id="å®¢æˆ·ç«¯å‘¨æœŸæ€§çš„è¶…æ—¶"><a href="#å®¢æˆ·ç«¯å‘¨æœŸæ€§çš„è¶…æ—¶" class="headerlink" title="å®¢æˆ·ç«¯å‘¨æœŸæ€§çš„è¶…æ—¶"></a>å®¢æˆ·ç«¯å‘¨æœŸæ€§çš„è¶…æ—¶</h3><h4 id="ç°è±¡-1"><a href="#ç°è±¡-1" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h4><p>å®¢æˆ·ç«¯ç°è±¡ï¼šå®¢æˆ·ç«¯å‡ºç°å¤§é‡å‘¨æœŸæ€§è¶…æ—¶<br>æœåŠ¡ç«¯ç°è±¡ï¼šæœåŠ¡ç«¯å¹¶æ²¡æœ‰æ˜æ˜¾çš„å¼‚å¸¸ï¼Œåªæ˜¯æœ‰ä¸€äº›æ…¢æŸ¥è¯¢æ“ä½œ</p>
<h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><ul>
<li>ç½‘ç»œï¼šæŸ¥çœ‹ç½‘ç»œè¿æ¥æ­£å¸¸</li>
<li>Redisï¼šæŸ¥çœ‹ Redis æ—¥å¿—ç»Ÿè®¡ï¼Œæœªå‘ç°å¼‚å¸¸</li>
<li>å®¢æˆ·ç«¯ï¼šæ…¢æŸ¥è¯¢ä¸è¶…æ—¶å‘ç”Ÿæ—¶é—´ç‚¹å»åˆï¼Œæ¨æ–­ç”±æ…¢æŸ¥è¯¢å¼•èµ·</li>
</ul>
<h1 id="ç¬¬-5-ç« -æŒä¹…åŒ–"><a href="#ç¬¬-5-ç« -æŒä¹…åŒ–" class="headerlink" title="ç¬¬ 5 ç«  æŒä¹…åŒ–"></a>ç¬¬ 5 ç«  æŒä¹…åŒ–</h1><h2 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h2><ul>
<li><code>save</code>å‘½ä»¤ï¼šé˜»å¡å½“å‰RedisæœåŠ¡å™¨ï¼Œç›´åˆ°RDBè¿‡ç¨‹å®Œæˆä¸ºæ­¢ï¼Œå¯¹äºå†…å­˜æ¯”è¾ƒå¤§çš„å®ä¾‹ä¼šé€ æˆé•¿æ—¶é—´é˜»å¡ï¼Œçº¿ä¸Šç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ã€‚</li>
<li><code>bgsave</code>å‘½ä»¤ï¼šRedisè¿›ç¨‹æ‰§è¡Œforkæ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼ŒRDBæŒä¹…åŒ–è¿‡ç¨‹ç”±å­è¿›ç¨‹è´Ÿè´£ï¼Œå®Œæˆåè‡ªåŠ¨ç»“æŸã€‚é˜»å¡åªå‘ç”Ÿåœ¨forké˜¶æ®µï¼Œä¸€èˆ¬æ—¶é—´å¾ˆçŸ­ã€‚</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g8tfeooj3zj30k60hptbk.jpg" alt="bgsave workflow"></p>
<p>è‡ªåŠ¨è§¦å‘åœºæ™¯ï¼š</p>
<ol>
<li>ä½¿ç”¨saveç›¸å…³é…ç½®ï¼Œå¦‚<code>save m n</code>ã€‚è¡¨ç¤º m ç§’å†…æ•°æ®é›†å­˜åœ¨ n æ¬¡ä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ bgsave</li>
<li>å¦‚æœä»èŠ‚ç‚¹æ‰§è¡Œå…¨é‡å¤åˆ¶æ“ä½œï¼Œä¸»èŠ‚ç‚¹è‡ªåŠ¨æ‰§è¡Œ bgsave ç”ŸæˆRDBæ–‡ä»¶å¹¶å‘é€ç»™ä»èŠ‚ç‚¹</li>
<li>æ‰§è¡Œ<code>debug reload</code>å‘½ä»¤é‡æ–°åŠ è½½Redisæ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨è§¦å‘ save æ“ä½œ</li>
<li>é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œ<code>shutdown</code>å‘½ä»¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ AOF æŒä¹…åŒ–åŠŸèƒ½åˆ™è‡ªåŠ¨æ‰§è¡Œ bgsave</li>
</ol>
<p>å¦‚æœRedisåŠ è½½æŸåçš„RDBæ–‡ä»¶æ—¶æ‹’ç»å¯åŠ¨ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨Redisæä¾›çš„<code>redis-check-dump</code>å·¥å…·æ£€æµ‹ RDB æ–‡ä»¶å¹¶è·å–å¯¹åº”çš„é”™è¯¯æŠ¥å‘Šã€‚</p>
<h3 id="RDB-çš„ä¼˜ç¼ºç‚¹"><a href="#RDB-çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="RDB çš„ä¼˜ç¼ºç‚¹"></a>RDB çš„ä¼˜ç¼ºç‚¹</h3><p>RDBçš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>RDBæ˜¯ä¸€ä¸ªç´§å‡‘å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»£è¡¨Redisåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ•°æ®å¿«ç…§ã€‚<strong>éå¸¸é€‚ç”¨äºå¤‡ä»½ï¼Œå…¨é‡å¤åˆ¶ç­‰åœºæ™¯</strong>ã€‚æ¯”å¦‚æ¯6å°æ—¶æ‰§è¡Œbgsaveå¤‡ä»½ï¼Œå¹¶æŠŠRDBæ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹æœºå™¨æˆ–è€…æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ˆå¦‚hdfsï¼‰ï¼Œç”¨äºç¾éš¾æ¢å¤ã€‚</li>
<li>RedisåŠ è½½RDBæ¢å¤æ•°æ®è¿œè¿œå¿«äºAOFçš„æ–¹å¼ã€‚</li>
</ul>
<p>RDBçš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>RDBæ–¹å¼æ•°æ®<strong>æ— æ³•åšåˆ°å®æ—¶æŒä¹…åŒ–/ç§’çº§æŒä¹…åŒ–</strong>ã€‚å› ä¸ºbgsaveæ¯æ¬¡è¿è¡Œéƒ½è¦æ‰§è¡Œforkæ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼Œå±äºé‡é‡çº§æ“ä½œï¼Œé¢‘ç¹æ‰§è¡Œæˆæœ¬è¿‡é«˜ã€‚</li>
<li>RDBæ–‡ä»¶ä½¿ç”¨ç‰¹å®šäºŒè¿›åˆ¶æ ¼å¼ä¿å­˜ï¼ŒRedisç‰ˆæœ¬æ¼”è¿›è¿‡ç¨‹ä¸­æœ‰å¤šä¸ªæ ¼å¼çš„RDBç‰ˆæœ¬ï¼Œå­˜åœ¨è€ç‰ˆæœ¬RedisæœåŠ¡æ— æ³•å…¼å®¹æ–°ç‰ˆRDBæ ¼å¼çš„é—®é¢˜ã€‚</li>
</ul>
<h2 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h2><p>AOFï¼ˆappend only fileï¼‰æŒä¹…åŒ–ï¼šä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•æ¯æ¬¡å†™å‘½ä»¤(ç±»ä¼¼äº MySQL çš„ Binlog)ï¼Œé‡å¯æ—¶å†é‡æ–°æ‰§è¡ŒAOFæ–‡ä»¶ä¸­çš„å‘½ä»¤è¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„ã€‚ç›®å‰å·²ç»æ˜¯RedisæŒä¹…åŒ–çš„ä¸»æµæ–¹å¼ã€‚</p>
<p>å¼€å¯AOFåŠŸèƒ½éœ€è¦è®¾ç½®é…ç½®ï¼š<code>appendonly yes</code>ï¼Œé»˜è®¤ä¸å¼€å¯ã€‚AOFæ–‡ä»¶åé€šè¿‡<code>appendfilename</code>é…ç½®è®¾ç½®ï¼Œé»˜è®¤æ–‡ä»¶åæ˜¯<code>appendonly.aof</code>ã€‚ä¿å­˜è·¯å¾„åŒ RDB æŒä¹…åŒ–æ–¹å¼ä¸€è‡´ï¼Œé€šè¿‡<code>dir</code>é…ç½®æŒ‡å®šã€‚<br><img src="https://tva1.sinaimg.cn/middle/006y8mN6ly1g8u1rzsipij30n811un3c.jpg" alt="AOF workflow"></p>
<p>AOFç¼“å†²åŒºåŒæ­¥æ–‡ä»¶ç­–ç•¥(å‚æ•°<code>appendfsync</code>)</p>
<table>
<thead>
<tr>
<th>å¯é…ç½®å€¼</th>
<th>è¯´æ˜</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>always</code></td>
<td>å‘½ä»¤å†™å…¥<code>aof_buf</code>åè°ƒç”¨ç³»ç»Ÿ<code>fsync</code>æ“ä½œåŒæ­¥åˆ° AOF æ–‡ä»¶ï¼Œ<code>fsync</code> å®Œæˆåçº¿ç¨‹è¿”å›</td>
<td>ä¸å»ºè®®</td>
</tr>
<tr>
<td><code>everysec</code></td>
<td>å‘½ä»¤å†™å…¥<code>aof_buf</code>åè°ƒç”¨ç³»ç»Ÿ<code>write</code>æ“ä½œï¼Œ<code>write</code>å®Œæˆåçº¿ç¨‹è¿”å›ã€‚<code>fsync</code>åŒæ­¥æ–‡ä»¶æ“ä½œç”±ä¸“é—¨çº¿ç¨‹æ¯ç§’è°ƒç”¨ä¸€æ¬¡ã€‚</td>
<td>å»ºè®®ï¼Œä¸ºé»˜è®¤é€‰é¡¹</td>
</tr>
<tr>
<td><code>no</code></td>
<td>å‘½ä»¤å†™å…¥<code>aof_buf</code>åè°ƒç”¨ç³»ç»Ÿ<code>write</code>æ“ä½œï¼Œä¸å¯¹ AOF æ–‡ä»¶åš<code>fsync</code>åŒæ­¥ï¼ŒåŒæ­¥ç¡¬ç›˜æ“ä½œç”± OS è´Ÿè´£ï¼Œé€šå¸¸åŒæ­¥å‘¨æœŸæœ€é•¿ 30s</td>
<td>æ•°æ®å®‰å…¨æ— æ³•å¾—åˆ°ä¿è¯</td>
</tr>
</tbody></table>
<p>aof é‡å†™è¿‡ç¨‹å¯é€šè¿‡æ‰‹åŠ¨ä¸è‡ªåŠ¨æ–¹å¼è§¦å‘ã€‚æ‰‹åŠ¨é€šè¿‡ç›´æ¥è°ƒç”¨<code>bgrewriteaof</code>å‘½ä»¤ï¼Œè‡ªåŠ¨æ–¹å¼åˆ™æ ¹æ®<code>auto-aof-rewrite-min-size</code>å’Œ<code>auto-aof-rewrite-percentage</code>çš„å‚æ•°ç¡®å®šè§¦å‘æ—¶æœºã€‚<br><img src="https://tva1.sinaimg.cn/middle/006y8mN6ly1g8u27kw8tmj30u00ws7ff.jpg" alt="AOF rewrite workflow"></p>
<h2 id="é‡å¯åŠ è½½"><a href="#é‡å¯åŠ è½½" class="headerlink" title="é‡å¯åŠ è½½"></a>é‡å¯åŠ è½½</h2><p>Redis å¯åŠ¨æ—¶ä¼šä¼˜å…ˆåŠ è½½ AOF æ–‡ä»¶ï¼Œå¦‚æœ AOF ä¸å¯åŠ è½½ï¼Œç„¶åå†åŠ è½½ RDB æ–‡ä»¶ã€‚å…¶æ–‡ä»¶åŠ è½½æµç¨‹å¦‚ä¸‹ï¼š<br><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g91c1tnqngj30ky0m3djy.jpg" alt=""></p>
<p>å¦‚æœåœ¨åŠ è½½ AOF æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼Œå¯ä»¥å…ˆè¿›è¡Œå¤‡ä»½ï¼Œç„¶åé‡‡ç”¨<code>redis-check-aof --fix</code>å‘½ä»¤è¿›è¡Œä¿®å¤ï¼Œä¿®å¤åä½¿ç”¨<code>diff -u</code>å¯¹æ¯”æ•°æ®çš„å·®å¼‚ï¼Œæ‰¾å‡ºä¸¢å¤±çš„æ•°æ®ï¼Œæœ‰äº›å¯ä»¥äººå·¥ä¿®æ”¹è¡¥å…¨ã€‚</p>
<p>AOFæ–‡ä»¶å¯èƒ½å­˜åœ¨ç»“å°¾ä¸å®Œæ•´çš„æƒ…å†µï¼Œæ¯”å¦‚æœºå™¨çªç„¶æ‰ç”µå¯¼è‡´AOFå°¾éƒ¨æ–‡ä»¶å‘½ä»¤å†™å…¥ä¸å…¨ã€‚Redisä¸ºæˆ‘ä»¬æä¾›äº†<code>aof-load-truncated</code>é…ç½®æ¥å…¼å®¹è¿™ç§æƒ…å†µï¼Œé»˜è®¤å¼€å¯ã€‚åŠ è½½AOFæ—¶ï¼Œå½“é‡åˆ°æ­¤é—®é¢˜æ—¶ä¼šå¿½ç•¥å¹¶ç»§ç»­å¯åŠ¨ï¼ŒåŒæ—¶æ‰“å°å¦‚ä¸‹è­¦å‘Šæ—¥å¿—ï¼š</p>
<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># !!! Warning: short read while loading the AOF file !!!</span><br><span class="line"># !!! Truncating the AOF at offset <span class="number">397856725</span> !!!</span><br><span class="line"># AOF loaded anyway because aof-load-truncated is enabled</span><br></pre></td></tr></table></figure>

<h2 id="é—®é¢˜å®šä½ä¸ä¼˜åŒ–"><a href="#é—®é¢˜å®šä½ä¸ä¼˜åŒ–" class="headerlink" title="é—®é¢˜å®šä½ä¸ä¼˜åŒ–"></a>é—®é¢˜å®šä½ä¸ä¼˜åŒ–</h2><h3 id="fork-æ“ä½œ"><a href="#fork-æ“ä½œ" class="headerlink" title="fork æ“ä½œ"></a>fork æ“ä½œ</h3><p>å½“ Redis åš RDB æˆ– AOF é‡å†™æ—¶ï¼Œå¯¹äºå¤§å¤šæ•°æ“ä½œç³»ç»Ÿæ¥è¯´ fork æ˜¯ä¸ªé‡é‡çº§é”™è¯¯ã€‚forkæ“ä½œè€—æ—¶è·Ÿè¿›ç¨‹æ€»å†…å­˜é‡æ¯æ¯ç›¸å…³ï¼Œå¦‚æœä½¿ç”¨è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œç‰¹åˆ«æ˜¯ Xen è™šæ‹Ÿæœºï¼Œfork æ“ä½œä¼šæ›´è€—æ—¶ã€‚</p>
<p>å¯¹äºé«˜å¹¶å‘ Redis å®ä¾‹ï¼Œå¦‚æœforkæ“ä½œè€—æ—¶åœ¨ç§’çº§åˆ«å°†æ‹–æ…¢ Redis å‡ ä¸‡æ¡å‘½ä»¤æ‰§è¡Œï¼Œå¯¹çº¿ä¸Šåº”ç”¨å»¶è¿Ÿå½±å“éå¸¸æ˜æ˜¾ã€‚æ­£å¸¸æƒ…å†µä¸‹ fork è€—æ—¶åº”è¯¥æ˜¯æ¯ GB æ¶ˆè€—20æ¯«ç§’å·¦å³ã€‚å¯ä»¥åœ¨<code>info stats</code>ç»Ÿè®¡ä¸­æŸ¥<code>latest_fork_usec</code>æŒ‡æ ‡è·å–æœ€è¿‘ä¸€æ¬¡ fork æ“ä½œè€—æ—¶ï¼Œå•ä½å¾®ç§’ã€‚</p>
<p>æ”¹å–„forkæ“ä½œçš„è€—æ—¶ï¼š</p>
<ol>
<li>ä¼˜å…ˆä½¿ç”¨ç‰©ç†æœºæˆ–è€…é«˜æ•ˆæ”¯æŒforkæ“ä½œçš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œé¿å…ä½¿ç”¨Xenã€‚</li>
<li>æ§åˆ¶ Redis å®ä¾‹æœ€å¤§å¯ç”¨å†…å­˜ï¼Œfork è€—æ—¶è·Ÿå†…å­˜é‡æˆæ­£æ¯”ï¼Œçº¿ä¸Šå»ºè®®æ¯ä¸ª Redis å®ä¾‹å†…å­˜æ§åˆ¶åœ¨ 10GB ä»¥å†…ã€‚</li>
<li>åˆç†é…ç½® Linux å†…å­˜åˆ†é…ç­–ç•¥ï¼Œé¿å…ç‰©ç†å†…å­˜ä¸è¶³å¯¼è‡´ fork å¤±è´¥ã€‚</li>
<li>é™ä½ fork æ“ä½œçš„é¢‘ç‡ï¼Œå¦‚é€‚åº¦æ”¾å®½ AOF è‡ªåŠ¨è§¦å‘æ—¶æœºï¼Œé¿å…ä¸å¿…è¦çš„å…¨é‡å¤åˆ¶ç­‰ã€‚</li>
</ol>
<h3 id="å­è¿›ç¨‹å¼€é”€ç›‘æ§å’Œä¼˜åŒ–"><a href="#å­è¿›ç¨‹å¼€é”€ç›‘æ§å’Œä¼˜åŒ–" class="headerlink" title="å­è¿›ç¨‹å¼€é”€ç›‘æ§å’Œä¼˜åŒ–"></a>å­è¿›ç¨‹å¼€é”€ç›‘æ§å’Œä¼˜åŒ–</h3><h4 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h4><ul>
<li>CPUå¼€é”€åˆ†æã€‚å­è¿›ç¨‹è´Ÿè´£æŠŠè¿›ç¨‹å†…çš„æ•°æ®åˆ†æ‰¹å†™å…¥æ–‡ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å±äºCPUå¯†é›†æ“ä½œï¼Œé€šå¸¸å­è¿›ç¨‹å¯¹å•æ ¸CPUåˆ©ç”¨ç‡æ¥è¿‘90%.</li>
<li>CPUæ¶ˆè€—ä¼˜åŒ–ã€‚Redisæ˜¯CPUå¯†é›†å‹æœåŠ¡ï¼Œä¸è¦åšç»‘å®šå•æ ¸CPUæ“ä½œã€‚ç”±äºå­è¿›ç¨‹éå¸¸æ¶ˆè€—CPUï¼Œä¼šå’Œçˆ¶è¿›ç¨‹äº§ç”Ÿå•æ ¸èµ„æºç«äº‰ã€‚</li>
<li>ä¸è¦å’Œå…¶ä»–CPUå¯†é›†å‹æœåŠ¡éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œé€ æˆCPUè¿‡åº¦ç«äº‰ã€‚</li>
<li>å¦‚æœéƒ¨ç½²å¤šä¸ªRediså®ä¾‹ï¼Œå°½é‡ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå­è¿›ç¨‹æ‰§è¡Œé‡å†™å·¥ä½œã€‚</li>
</ul>
<h4 id="ç¡¬ç›˜å¼€é”€"><a href="#ç¡¬ç›˜å¼€é”€" class="headerlink" title="ç¡¬ç›˜å¼€é”€"></a>ç¡¬ç›˜å¼€é”€</h4><ul>
<li>ä¸è¦å’Œå…¶ä»–é«˜ç¡¬ç›˜è´Ÿè½½çš„æœåŠ¡éƒ¨ç½²åœ¨ä¸€èµ·ã€‚å¦‚ï¼šå­˜å‚¨æœåŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ç­‰ã€‚</li>
<li>AOFé‡å†™æ—¶ä¼šæ¶ˆè€—å¤§é‡ç¡¬ç›˜IOï¼Œå¯ä»¥å¼€å¯é…ç½®<code>no-appendfsync-on-rewrite</code>ï¼Œé»˜è®¤å…³é—­ã€‚è¡¨ç¤ºåœ¨AOFé‡å†™æœŸé—´ä¸åš<code>fsync</code>æ“ä½œã€‚</li>
<li>å½“å¼€å¯ AOF åŠŸèƒ½çš„ Redis ç”¨äºé«˜æµé‡å†™å…¥åœºæ™¯æ—¶ï¼Œå¦‚æœä½¿ç”¨æ™®é€šæœºæ¢°ç£ç›˜ï¼Œå†™å…¥ååä¸€èˆ¬åœ¨100MB/så·¦å³ï¼Œè¿™æ—¶ Redis å®ä¾‹çš„ç“¶é¢ˆä¸»è¦åœ¨ AOF åŒæ­¥ç¡¬ç›˜ä¸Šã€‚</li>
<li>å¯¹äºå•æœºé…ç½®å¤šä¸ª Redis å®ä¾‹çš„æƒ…å†µï¼Œå¯ä»¥é…ç½®ä¸åŒå®ä¾‹åˆ†ç›˜å­˜å‚¨ AOF æ–‡ä»¶ï¼Œåˆ†æ‘Šç¡¬ç›˜å†™å…¥å‹åŠ›ã€‚</li>
</ul>
<blockquote>
<p>âš ï¸ é…ç½®<code>no-appendfsync-on-rewrite=yes</code>æ—¶ï¼Œåœ¨æç«¯æƒ…å†µä¸‹å¯èƒ½ä¸¢å¤±æ•´ä¸ªAOFé‡å†™æœŸé—´çš„æ•°æ®ï¼Œéœ€è¦æ ¹æ®æ•°æ®å®‰å…¨æ€§å†³å®šæ˜¯å¦é…ç½®ã€‚</p>
</blockquote>
<h3 id="AOF-è¿½åŠ é˜»å¡"><a href="#AOF-è¿½åŠ é˜»å¡" class="headerlink" title="AOF è¿½åŠ é˜»å¡"></a>AOF è¿½åŠ é˜»å¡</h3><p>å½“ Redis æ‰§è¡Œ <code>fsync</code> åŒæ­¥æ—¶ï¼Œå¦‚æœç³»ç»Ÿç¡¬ç›˜ç¹å¿™ï¼Œä¼šé€ æˆ Redis ä¸»çº¿ç¨‹çš„é˜»å¡ã€‚<br><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g91co0mb8fj30g40hz770.jpg" alt=""></p>
<p>æ¯å½“å‘ç”Ÿ AOF è¿½åŠ é˜»å¡äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œåœ¨<code>info Persistence</code>ç»Ÿè®¡ä¸­ï¼Œ<code>aof_delayed_fsync</code>æŒ‡æ ‡ä¼šç´¯åŠ ï¼ŒæŸ¥çœ‹è¿™ä¸ªæŒ‡æ ‡æ–¹ä¾¿å®šä½ AOF é˜»å¡é—®é¢˜ã€‚AOFåŒæ­¥æœ€å¤šå…è®¸2ç§’çš„å»¶è¿Ÿï¼Œå½“å»¶è¿Ÿå‘ç”Ÿæ—¶è¯´æ˜ç¡¬ç›˜å­˜åœ¨é«˜è´Ÿè½½é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ç›‘æ§å·¥å…·å¦‚<code>iotop</code>ï¼Œå®šä½æ¶ˆè€—ç¡¬ç›˜IOèµ„æºçš„è¿›ç¨‹ã€‚</p>
<h2 id="æœ¬ç« æ€»ç»“"><a href="#æœ¬ç« æ€»ç»“" class="headerlink" title="æœ¬ç« æ€»ç»“"></a>æœ¬ç« æ€»ç»“</h2><ul>
<li>RDBä½¿ç”¨ä¸€æ¬¡æ€§ç”Ÿæˆå†…å­˜å¿«ç…§çš„æ–¹å¼ï¼Œäº§ç”Ÿçš„æ–‡ä»¶ç´§å‡‘å‹ç¼©æ¯”æ›´é«˜ï¼Œå› æ­¤è¯»å–RDBæ¢å¤é€Ÿåº¦æ›´å¿«ã€‚ç”±äºæ¯æ¬¡ç”ŸæˆRDBå¼€é”€è¾ƒå¤§ï¼Œ<strong>æ— æ³•åšåˆ°å®æ—¶æŒä¹…åŒ–ï¼Œä¸€èˆ¬ç”¨äºæ•°æ®å†·å¤‡å’Œå¤åˆ¶ä¼ è¾“</strong>ã€‚</li>
<li>AOFé€šè¿‡è¿½åŠ å†™å‘½ä»¤åˆ°æ–‡ä»¶å®ç°æŒä¹…åŒ–ï¼Œé€šè¿‡<code>appendfsync</code>å‚æ•°å¯ä»¥æ§åˆ¶å®æ—¶/ç§’çº§æŒä¹…åŒ–ã€‚å› ä¸ºéœ€è¦ä¸æ–­è¿½åŠ å†™å‘½ä»¤ï¼Œæ‰€ä»¥AOFæ–‡ä»¶ä½“ç§¯é€æ¸å˜å¤§ï¼Œéœ€è¦å®šæœŸæ‰§è¡Œé‡å†™æ“ä½œæ¥é™ä½æ–‡ä»¶ä½“ç§¯ã€‚</li>
<li>AOFé‡å†™å¯ä»¥é€šè¿‡<code>auto-aof-rewrite-min-size</code> å’Œ <code>auto-aof-rewritepercentage</code>å‚æ•°æ§åˆ¶è‡ªåŠ¨è§¦å‘ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>bgrewriteaof</code>å‘½ä»¤æ‰‹åŠ¨è§¦å‘ã€‚</li>
<li>å­è¿›ç¨‹æ‰§è¡ŒæœŸé—´ä½¿ç”¨<code>copy-on-write</code>æœºåˆ¶ä¸çˆ¶è¿›ç¨‹å…±äº«å†…å­˜ï¼Œé¿å…å†…å­˜æ¶ˆè€—ç¿»å€ã€‚AOFé‡å†™æœŸé—´è¿˜éœ€è¦ç»´æŠ¤é‡å†™ç¼“å†²åŒºï¼Œä¿å­˜æ–°çš„å†™å…¥å‘½ä»¤é¿å…æ•°æ®ä¸¢å¤±ã€‚</li>
</ul>
<h1 id="ç¬¬-6-ç« -å¤åˆ¶"><a href="#ç¬¬-6-ç« -å¤åˆ¶" class="headerlink" title="ç¬¬ 6 ç«  å¤åˆ¶"></a>ç¬¬ 6 ç«  å¤åˆ¶</h1><h2 id="å»ºç«‹å¤åˆ¶"><a href="#å»ºç«‹å¤åˆ¶" class="headerlink" title="å»ºç«‹å¤åˆ¶"></a>å»ºç«‹å¤åˆ¶</h2><p>é…ç½®å¤åˆ¶çš„ä¸‰ç§æ–¹å¼</p>
<ol>
<li>åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥<code>slaveof {masterHost} {masterPort}</code> éšRediså¯åŠ¨ç”Ÿæ•ˆã€‚</li>
<li>åœ¨<code>redis-server</code>å¯åŠ¨å‘½ä»¤ååŠ å…¥<code>--slaveof {masterHost} {masterPort}</code> ç”Ÿæ•ˆã€‚</li>
<li>ç›´æ¥ä½¿ç”¨å‘½ä»¤<code>slaveof {masterHost} {masterPort}</code>ç”Ÿæ•ˆã€‚</li>
</ol>
<p>ä¸»ä»èŠ‚ç‚¹å¤åˆ¶æˆåŠŸå»ºç«‹åï¼Œå¯ä»¥ä½¿ç”¨<code>info replication</code>å‘½ä»¤æŸ¥çœ‹å¤åˆ¶ç›¸å…³çŠ¶æ€ã€‚</p>
<h2 id="æ–­å¼€å¤åˆ¶"><a href="#æ–­å¼€å¤åˆ¶" class="headerlink" title="æ–­å¼€å¤åˆ¶"></a>æ–­å¼€å¤åˆ¶</h2><p><code>slaveof</code>å‘½ä»¤ä¸ä½†å¯ä»¥å»ºç«‹å¤åˆ¶ï¼Œè¿˜å¯ä»¥åœ¨ä»èŠ‚ç‚¹æ‰§è¡Œ<code>slaveof no one</code>æ¥æ–­å¼€ä¸ä¸»èŠ‚ç‚¹å¤åˆ¶å…³ç³»ã€‚åŒæ—¶ï¼Œ<code>slaveof {newMasterIp} {newMasterPort}</code>è¿˜å¯ä»¥å®ç°åˆ‡ä¸»æ“ä½œï¼Œæ›´æ¢ä¸»èŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>âš ï¸ åˆ‡ä¸»åä»èŠ‚ç‚¹ä¼šæ¸…ç©ºä¹‹å‰æ‰€æœ‰çš„æ•°æ®ï¼Œçº¿ä¸Šäººå·¥æ“ä½œæ—¶å°å¿ƒ<code>slaveof</code>åœ¨é”™è¯¯çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œæˆ–è€…æŒ‡å‘é”™è¯¯çš„ä¸»èŠ‚ç‚¹ã€‚</p>
</blockquote>
<p>å¯¹äºæ•°æ®æ¯”è¾ƒé‡è¦çš„èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹ä¼šé€šè¿‡è®¾ç½®<code>requirepass</code>å‚æ•°è¿›è¡Œå¯†ç éªŒè¯ï¼Œè¿™æ—¶æ‰€æœ‰çš„å®¢æˆ·ç«¯è®¿é—®å¿…é¡»ä½¿ç”¨<code>auth</code>å‘½ä»¤å®è¡Œæ ¡éªŒã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä»èŠ‚ç‚¹ä½¿ç”¨<code>slave-read-only=yes</code>é…ç½®ä¸ºåªè¯»æ¨¡å¼ã€‚ç”±äºå¤åˆ¶åªèƒ½ä»ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ï¼Œå¯¹äºä»èŠ‚ç‚¹çš„ä»»ä½•ä¿®æ”¹ä¸»èŠ‚ç‚¹éƒ½æ— æ³•æ„ŸçŸ¥ï¼Œä¿®æ”¹ä»èŠ‚ç‚¹ä¼šé€ æˆä¸»ä»æ•°æ®ä¸ä¸€è‡´ã€‚å› æ­¤å»ºè®®çº¿ä¸Šä¸è¦ä¿®æ”¹ä»èŠ‚ç‚¹çš„åªè¯»æ¨¡å¼ã€‚</p>
<p>Redisä¸ºæˆ‘ä»¬æä¾›äº†<code>repl-disable-tcp-nodelay</code>å‚æ•°ç”¨äºæ§åˆ¶æ˜¯å¦å…³é—­<code>TCP_NODELAY</code>ï¼Œé»˜è®¤å…³é—­ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li>å½“å…³é—­æ—¶ï¼Œä¸»èŠ‚ç‚¹äº§ç”Ÿçš„å‘½ä»¤æ•°æ®æ— è®ºå¤§å°éƒ½ä¼šåŠæ—¶åœ°å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œè¿™æ ·ä¸»ä»ä¹‹é—´å»¶è¿Ÿä¼šå˜å°ï¼Œä½†å¢åŠ äº†ç½‘ç»œå¸¦å®½çš„æ¶ˆè€—ã€‚é€‚ç”¨äºä¸»ä»ä¹‹é—´çš„ç½‘ç»œç¯å¢ƒè‰¯å¥½çš„åœºæ™¯ï¼Œå¦‚åŒæœºæ¶æˆ–åŒæœºæˆ¿éƒ¨ç½²ã€‚</li>
<li>å½“å¼€å¯æ—¶ï¼Œä¸»èŠ‚ç‚¹ä¼šåˆå¹¶è¾ƒå°çš„TCPæ•°æ®åŒ…ä»è€ŒèŠ‚çœå¸¦å®½ã€‚é»˜è®¤å‘é€æ—¶é—´é—´éš”å–å†³äºLinuxçš„å†…æ ¸ï¼Œä¸€èˆ¬é»˜è®¤ä¸º40æ¯«ç§’ã€‚è¿™ç§é…ç½®èŠ‚çœäº†å¸¦å®½ä½†å¢å¤§ä¸»ä»ä¹‹é—´çš„å»¶è¿Ÿã€‚é€‚ç”¨äºä¸»ä»ç½‘ç»œç¯å¢ƒå¤æ‚æˆ–å¸¦å®½ç´§å¼ çš„åœºæ™¯ï¼Œå¦‚è·¨æœºæˆ¿éƒ¨ç½²ã€‚</li>
</ul>
<h2 id="æ‹“æ‰‘"><a href="#æ‹“æ‰‘" class="headerlink" title="æ‹“æ‰‘"></a>æ‹“æ‰‘</h2><p>æ ¹æ®æ‹“æ‰‘çš„å¤æ‚æ€§ï¼Œå¯åˆ†ä¸ºä¸‰ç§ï¼šä¸€ä¸»ä¸€ä»ã€ä¸€ä¸»å¤šä»ã€æ ‘çŠ¶ä¸»ä»ç»“æ„ã€‚</p>
<h3 id="ä¸€ä¸»ä¸€ä»"><a href="#ä¸€ä¸»ä¸€ä»" class="headerlink" title="ä¸€ä¸»ä¸€ä»"></a>ä¸€ä¸»ä¸€ä»</h3><p>å½“åº”ç”¨å†™å‘½ä»¤å¹¶å‘é‡è¾ƒé«˜ä¸”éœ€è¦æŒä¹…åŒ–æ—¶ï¼Œå¯ä»¥åªåœ¨ä»èŠ‚ç‚¹ä¸Šå¼€å¯AOFï¼Œè¿™æ ·æ—¢ä¿è¯æ•°æ®å®‰å…¨æ€§åŒæ—¶ä¹Ÿé¿å…äº†æŒä¹…åŒ–å¯¹ä¸»èŠ‚ç‚¹çš„æ€§èƒ½å¹²æ‰°ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä¸»èŠ‚ç‚¹å…³é—­æŒä¹…åŒ–åŠŸèƒ½æ—¶ï¼Œå¦‚æœä¸»èŠ‚ç‚¹è„±æœºè¦é¿å…è‡ªåŠ¨é‡å¯æ“ä½œã€‚å› ä¸ºä¸»èŠ‚ç‚¹ä¹‹å‰æ²¡æœ‰å¼€å¯æŒä¹…åŒ–åŠŸèƒ½è‡ªåŠ¨é‡å¯åæ•°æ®é›†ä¸ºç©ºï¼Œè¿™æ—¶ä»èŠ‚ç‚¹å¦‚æœç»§ç»­å¤åˆ¶ä¸»èŠ‚ç‚¹ä¼šå¯¼è‡´ä»èŠ‚ç‚¹æ•°æ®ä¹Ÿè¢«æ¸…ç©ºçš„æƒ…å†µï¼Œä¸§å¤±äº†æŒä¹…åŒ–çš„æ„ä¹‰ã€‚å®‰å…¨çš„åšæ³•æ˜¯åœ¨ä»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ<code>slaveof no one</code>æ–­å¼€ä¸ä¸»èŠ‚ç‚¹çš„å¤åˆ¶å…³ç³»ï¼Œå†é‡å¯ä¸»èŠ‚ç‚¹ä»è€Œé¿å…è¿™ä¸€é—®é¢˜ã€‚</p>
<h3 id="ä¸€ä¸»å¤šä»"><a href="#ä¸€ä¸»å¤šä»" class="headerlink" title="ä¸€ä¸»å¤šä»"></a>ä¸€ä¸»å¤šä»</h3><p>å¯¹äºå†™å¹¶å‘é‡è¾ƒé«˜çš„åœºæ™¯ï¼Œå¤šä¸ªä»èŠ‚ç‚¹ä¼šå¯¼è‡´ä¸»èŠ‚ç‚¹å†™å‘½ä»¤çš„å¤šæ¬¡å‘é€ä»è€Œè¿‡åº¦æ¶ˆè€—ç½‘ç»œå¸¦å®½ï¼ŒåŒæ—¶ä¹ŸåŠ é‡äº†ä¸»èŠ‚ç‚¹çš„è´Ÿè½½å½±å“æœåŠ¡ç¨³å®šæ€§ã€‚</p>
<h3 id="æ ‘çŠ¶ä¸»ä»ç»“æ„"><a href="#æ ‘çŠ¶ä¸»ä»ç»“æ„" class="headerlink" title="æ ‘çŠ¶ä¸»ä»ç»“æ„"></a>æ ‘çŠ¶ä¸»ä»ç»“æ„</h3><p>å½“ä¸»èŠ‚ç‚¹éœ€è¦æŒ‚è½½å¤šä¸ªä»èŠ‚ç‚¹æ—¶ä¸ºäº†é¿å…å¯¹ä¸»èŠ‚ç‚¹çš„æ€§èƒ½å¹²æ‰°ï¼Œå¯ä»¥é‡‡ç”¨æ ‘çŠ¶ä¸»ä»ç»“æ„é™ä½ä¸»èŠ‚ç‚¹å‹åŠ›ã€‚</p>
<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g91e0yu7flj30if0o442t.jpg" alt=""></p>
<h3 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h3><p>Redis åœ¨åˆæ¬¡å¤åˆ¶æ—¶ï¼Œä¼šè¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œä¹‹åä¾¿ä¼šæ ¹æ®ä¸»ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡è¿›è¡Œ<code>psync</code>å¢é‡å¤åˆ¶ã€‚</p>
<p><code>psync</code>å‘½ä»¤è¿è¡Œéœ€è¦ä»¥ä¸‹ç»„ä»¶æ”¯æŒï¼š</p>
<ul>
<li>ä¸»ä»èŠ‚ç‚¹å„è‡ªå¤åˆ¶åç§»é‡ã€‚</li>
<li>ä¸»èŠ‚ç‚¹å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€‚</li>
<li>ä¸»èŠ‚ç‚¹è¿è¡Œidã€‚</li>
</ul>
<h4 id="å¤åˆ¶åç§»é‡"><a href="#å¤åˆ¶åç§»é‡" class="headerlink" title="å¤åˆ¶åç§»é‡"></a>å¤åˆ¶åç§»é‡</h4><p>å‚ä¸å¤åˆ¶çš„ä¸»ä»èŠ‚ç‚¹éƒ½ä¼šç»´æŠ¤è‡ªèº«å¤åˆ¶åç§»é‡ã€‚ä¸»èŠ‚ç‚¹åœ¨ç†å®Œå†™å…¥å‘½ä»¤åï¼Œä¼šæŠŠå‘½ä»¤çš„å­—èŠ‚é•¿åº¦åšç´¯åŠ è®°å½•ï¼Œç»Ÿè®¡ä¿¡æ¯åœ¨<code>info relication</code>ä¸­çš„<code>master_repl_offset</code>æŒ‡æ ‡ä¸­ï¼Œä»èŠ‚ç‚¹ä¼šæ¯ç§’é’Ÿä¸ŠæŠ¥è‡ªèº«çš„å¤åˆ¶åç§»é‡ç»™ä¸»èŠ‚ç‚¹ï¼Œå› æ­¤ä¸»èŠ‚ç‚¹ä¹Ÿä¼šä¿å­˜ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ã€‚ä»èŠ‚ç‚¹åœ¨æ¥æ”¶åˆ°ä¸»èŠ‚ç‚¹å‘é€çš„å‘½ä»¤åï¼Œä¹Ÿä¼šç´¯åŠ è®°å½•è‡ªèº«çš„åç§»é‡ã€‚ç»Ÿè®¡ä¿¡æ¯åœ¨<code>info relication</code>ä¸­çš„<code>slave_repl_offset</code>æŒ‡æ ‡ä¸­ã€‚</p>
<p>å¯ä»¥é€šè¿‡ä¸»èŠ‚ç‚¹çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè®¡ç®—å‡º<code>master_repl_offset_slave_offset</code>å­—èŠ‚é‡ï¼Œåˆ¤æ–­ä¸»ä»èŠ‚ç‚¹å¤åˆ¶ç›¸å·®çš„æ•°æ®é‡ï¼Œæ ¹æ®è¿™ä¸ªå·®å€¼åˆ¤å®šå½“å‰å¤åˆ¶çš„å¥åº·åº¦ã€‚å¦‚æœä¸»ä»ä¹‹é—´å¤åˆ¶åç§»é‡ç›¸å·®è¾ƒå¤§ï¼Œåˆ™å¯èƒ½æ˜¯ç½‘ç»œå»¶è¿Ÿæˆ–å‘½ä»¤é˜»å¡ç­‰åŸå› å¼•èµ·ã€‚</p>
<h4 id="å¤åˆ¶ç§¯å‹ç¼“å†²åŒº"><a href="#å¤åˆ¶ç§¯å‹ç¼“å†²åŒº" class="headerlink" title="å¤åˆ¶ç§¯å‹ç¼“å†²åŒº"></a>å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g91vyy7e25j30h909875n.jpg" alt=""></p>
<p>ä¸»èŠ‚ç‚¹å“åº”ä»èŠ‚ç‚¹çš„åŒæ­¥æ—¶ï¼Œä¸ä½†ä¼šæŠŠå‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œè¿˜ä¼šå†™å…¥å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€‚ç”±äºç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯å…ˆè¿›å…ˆå‡ºçš„å®šé•¿é˜Ÿåˆ—ï¼Œæ‰€ä»¥èƒ½å®ç°ä¿å­˜æœ€è¿‘å·²å¤åˆ¶æ•°æ®çš„åŠŸèƒ½ï¼Œç”¨äºéƒ¨åˆ†å¤åˆ¶å’Œå¤åˆ¶å‘½ä»¤ä¸¢å¤±çš„æ•°æ®è¡¥æ•‘ã€‚å¤åˆ¶ç¼“å†²åŒºç›¸å…³ç»Ÿè®¡ä¿¡æ¯ä¿å­˜åœ¨ä¸»èŠ‚ç‚¹çš„<code>info replication</code>ä¸­ã€‚</p>
<h4 id="ä¸»èŠ‚ç‚¹è¿è¡ŒID"><a href="#ä¸»èŠ‚ç‚¹è¿è¡ŒID" class="headerlink" title="ä¸»èŠ‚ç‚¹è¿è¡ŒID"></a>ä¸»èŠ‚ç‚¹è¿è¡ŒID</h4><p>æ¯ä¸ªRedisèŠ‚ç‚¹å¯åŠ¨åéƒ½ä¼šåŠ¨æ€åˆ†é…ä¸€ä¸ª40ä½çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸ºè¿è¡ŒIDã€‚è¿è¡ŒIDçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å”¯ä¸€è¯†åˆ«RedisèŠ‚ç‚¹ï¼Œæ¯”å¦‚ä»èŠ‚ç‚¹ä¿å­˜ä¸»èŠ‚ç‚¹çš„è¿è¡ŒIDè¯†åˆ«è‡ªå·±æ­£åœ¨å¤åˆ¶çš„æ˜¯å“ªä¸ªä¸»èŠ‚ç‚¹ã€‚å¦‚æœåªä½¿ç”¨ip+portçš„æ–¹å¼è¯†åˆ«ä¸»èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹é‡å¯å˜æ›´äº†æ•´ä½“æ•°æ®é›†ï¼ˆå¦‚æ›¿æ¢RDB/AOFæ–‡ä»¶ï¼‰ï¼Œä»èŠ‚ç‚¹å†åŸºäºåç§»é‡å¤åˆ¶æ•°æ®å°†æ˜¯ä¸å®‰å…¨çš„ï¼Œå› æ­¤å½“è¿è¡ŒIDå˜åŒ–åä»èŠ‚ç‚¹å°†åšå…¨é‡å¤åˆ¶ã€‚å¯ä»¥è¿è¡Œ<code>info server</code>å‘½ä»¤æŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„è¿è¡ŒIDã€‚</p>
<p>å½“éœ€è¦è°ƒä¼˜ä¸€äº›å†…å­˜ç›¸å…³é…ç½®ï¼Œä¾‹å¦‚ï¼š<code>hash-max-ziplist-value</code>ç­‰ï¼Œè¿™äº›é…ç½®éœ€è¦Redisé‡æ–°åŠ è½½æ‰èƒ½ä¼˜åŒ–å·²å­˜åœ¨çš„æ•°æ®ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨<code>debug reload</code>å‘½ä»¤é‡æ–°åŠ è½½ RDB å¹¶ä¿æŒè¿è¡Œ ID ä¸å˜ï¼Œä»è€Œæœ‰æ•ˆé¿å…ä¸å¿…è¦çš„å…¨é‡å¤åˆ¶ã€‚</p>
<blockquote>
<p><code>debug reload</code>å‘½ä»¤ä¼šé˜»å¡å½“å‰RedisèŠ‚ç‚¹ä¸»çº¿ç¨‹ï¼Œé˜»å¡æœŸé—´ä¼šç”Ÿæˆæœ¬åœ°RDBå¿«ç…§å¹¶æ¸…ç©ºæ•°æ®ä¹‹åå†åŠ è½½RDBæ–‡ä»¶ã€‚å› æ­¤å¯¹äºå¤§æ•°æ®é‡çš„ä¸»èŠ‚ç‚¹å’Œæ— æ³•å®¹å¿é˜»å¡çš„åº”ç”¨åœºæ™¯ï¼Œè°¨æ…ä½¿ç”¨ã€‚</p>
</blockquote>
<h4 id="psync-å‘½ä»¤"><a href="#psync-å‘½ä»¤" class="headerlink" title="psync å‘½ä»¤"></a>psync å‘½ä»¤</h4><p>ä»èŠ‚ç‚¹ä½¿ç”¨<code>psync</code>å‘½ä»¤å®Œæˆéƒ¨åˆ†å¤åˆ¶å’Œå…¨é‡å¤åˆ¶åŠŸèƒ½ï¼Œå‘½ä»¤æ ¼å¼ï¼š<code>psync {runId} {offset}</code></p>
<p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g91xk5bba1j30jh0hejtq.jpg" alt=""></p>
<p>ä¸»èŠ‚ç‚¹å›å¤<code>+FULLRESYNC {runId} {offset}</code>ä¼šè§¦å‘å…¨é‡å¤åˆ¶ï¼Œ<code>+CONTINUE</code>åˆ™è§¦å‘å¢é‡å¤åˆ¶ã€‚</p>
<h4 id="å…¨é‡åŒæ­¥"><a href="#å…¨é‡åŒæ­¥" class="headerlink" title="å…¨é‡åŒæ­¥"></a>å…¨é‡åŒæ­¥</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g91xn7bm5rj30j30lqgp7.jpg" alt=""></p>
<p>å¯¹äºä»èŠ‚ç‚¹å¼€å§‹æ¥æ”¶RDBå¿«ç…§åˆ°æ¥æ”¶å®ŒæˆæœŸé—´ï¼Œä¸»èŠ‚ç‚¹ä»ç„¶å“åº”è¯»å†™å‘½ä»¤ï¼Œå› æ­¤ä¸»èŠ‚ç‚¹ä¼šæŠŠè¿™æœŸé—´å†™å‘½ä»¤æ•°æ®ä¿å­˜åœ¨å¤åˆ¶å®¢æˆ·ç«¯ç¼“å†²åŒºå†…ï¼Œå½“ä»èŠ‚ç‚¹åŠ è½½å®ŒRDBæ–‡ä»¶åï¼Œä¸»èŠ‚ç‚¹å†æŠŠç¼“å†²åŒºå†…çš„æ•°æ®å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä¿è¯ä¸»ä»ä¹‹é—´æ•°æ®ä¸€è‡´æ€§ã€‚å¦‚æœ RDB æ–‡ä»¶è¿‡å¤§ï¼Œè¶…è¿‡é¢„è®¾çš„ timeoutï¼Œåˆ™ä¼šç»ˆæ­¢å…¨é‡åŒæ­¥ï¼Œå¹¶æ¸…é™¤å·²ä¸‹è½½ä¸´æ—¶æ–‡ä»¶ã€‚å¦‚æœåœ¨é«˜å¹¶å‘å†™çš„åœºæ™¯ï¼Œä¸»èŠ‚ç‚¹çš„ç¼“å†²åŒºè¢«å†™æ»¡ï¼ŒåŒæ ·ä¼šå¯¼è‡´åŒæ­¥çš„å¤±è´¥ã€‚</p>
<p>å…¨é‡å¤åˆ¶çš„ä¸»è¦æ—¶é—´å¼€é”€åœ¨ï¼š</p>
<ul>
<li>ä¸»èŠ‚ç‚¹ <code>bgsave</code> æ—¶é—´</li>
<li>RDB æ–‡ä»¶ç½‘ç»œä¼ è¾“æ—¶é—´</li>
<li>ä»èŠ‚ç‚¹æ¸…ç©ºæ•°æ®æ—¶é—´</li>
<li>ä»èŠ‚ç‚¹åŠ è½½ RDB æ—¶é—´</li>
<li>å¯èƒ½çš„ AOF é‡å†™æ—¶é—´</li>
</ul>
<h4 id="å¢é‡åŒæ­¥"><a href="#å¢é‡åŒæ­¥" class="headerlink" title="å¢é‡åŒæ­¥"></a>å¢é‡åŒæ­¥</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g91xwacukej30hu0d8gnx.jpg" alt=""></p>
<h4 id="å¿ƒè·³"><a href="#å¿ƒè·³" class="headerlink" title="å¿ƒè·³"></a>å¿ƒè·³</h4><p>ä¸»ä»å¿ƒè·³åˆ¤æ–­æœºåˆ¶ï¼š</p>
<ul>
<li>é€šè¿‡<code>client list</code>å‘½ä»¤æŸ¥çœ‹å¤åˆ¶ç›¸å…³å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œä¸»èŠ‚ç‚¹çš„è¿æ¥çŠ¶æ€ä¸º<code>flags=M</code>ï¼Œä»èŠ‚ç‚¹è¿æ¥çŠ¶æ€ä¸º<code>flags=S</code>ã€‚</li>
<li>ä¸»èŠ‚ç‚¹é»˜è®¤æ¯éš”10ç§’å¯¹ä»èŠ‚ç‚¹å‘é€<code>ping</code>å‘½ä»¤ï¼Œåˆ¤æ–­ä»èŠ‚ç‚¹çš„å­˜æ´»æ€§å’Œè¿æ¥çŠ¶æ€ã€‚å¯é€šè¿‡å‚æ•°<code>repl-ping-slave-period</code>æ§åˆ¶å‘é€é¢‘ç‡ã€‚</li>
<li>ä»èŠ‚ç‚¹åœ¨ä¸»çº¿ç¨‹ä¸­æ¯éš”1ç§’å‘é€<code>replconf ack{offset}</code>å‘½ä»¤ï¼Œç»™ä¸»èŠ‚ç‚¹ä¸ŠæŠ¥è‡ªèº«å½“å‰çš„å¤åˆ¶åç§»é‡ã€‚<code>replconf</code>å‘½ä»¤ä¸»è¦ä½œç”¨å¦‚ä¸‹ï¼š<ul>
<li>å®æ—¶ç›‘æµ‹ä¸»ä»èŠ‚ç‚¹ç½‘ç»œçŠ¶æ€</li>
<li>ä¸ŠæŠ¥è‡ªèº«å¤åˆ¶åç§»é‡ï¼Œæ£€æŸ¥å¤åˆ¶æ•°æ®æ˜¯å¦ä¸¢å¤±ï¼Œå¦‚æœä»èŠ‚ç‚¹æ•°æ®ä¸¢å¤±ï¼Œå†ä»ä¸»èŠ‚ç‚¹çš„å¤åˆ¶ç¼“å†²åŒºä¸­æ‹‰å–ä¸¢å¤±æ•°æ®</li>
<li>å®ç°ä¿è¯ä»èŠ‚ç‚¹çš„æ•°é‡å’Œå»¶è¿Ÿæ€§åŠŸèƒ½ï¼Œé€šè¿‡min-slaves-to-writeã€minslaves-max-lagå‚æ•°é…ç½®å®šä¹‰</li>
</ul>
</li>
</ul>
<blockquote>
<p>æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°æ•°æ®åŒæ­¥çš„é—®é¢˜ï¼Œä½†å¦‚ä½•åœ¨æ¶ˆè€—æœ€å°‘çš„èµ„æºä¸‹ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§æ˜¯æˆ‘ä»¬ä¸€ç›´ä¼šé‡åˆ°çš„é—®é¢˜ï¼Œå¥½åœ¨ï¼Œå¾ˆå¤šæˆç†Ÿçš„ è½¯ä»¶å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†å€Ÿé‰´çš„æ–¹æ¡ˆï¼Œå¦‚ Git çš„ hash chainï¼ŒRedis çš„ <code>psync</code> åç§»é‡å¢é‡å¤åˆ¶ä¸ç¼“å†²åŒºï¼Œä»¥åŠ MySQL çš„<code>binlog</code>ã€‚æ²¡æœ‰æœ€å¥½çš„æ–¹æ¡ˆï¼Œåªæœ‰æœ€åˆé€‚çš„æ–¹æ¡ˆï¼Œæˆ–è®¸æˆ‘ä»¬èƒ½ä»ä¸­å¾—åˆ°å¯å‘ï¼Œæ‰¾åˆ°æœ€é€‚åˆè‡ªå·±çš„å¢é‡åŒæ­¥æ–¹å¼ã€‚</p>
</blockquote>
<h2 id="å¼€å‘ä¸è¿ç»´ä¸­çš„é—®é¢˜"><a href="#å¼€å‘ä¸è¿ç»´ä¸­çš„é—®é¢˜" class="headerlink" title="å¼€å‘ä¸è¿ç»´ä¸­çš„é—®é¢˜"></a>å¼€å‘ä¸è¿ç»´ä¸­çš„é—®é¢˜</h2><h3 id="æ•°æ®å»¶æ—¶"><a href="#æ•°æ®å»¶æ—¶" class="headerlink" title="æ•°æ®å»¶æ—¶"></a>æ•°æ®å»¶æ—¶</h3><p>Rediså¤åˆ¶æ•°æ®çš„å»¶è¿Ÿç”±äºå¼‚æ­¥å¤åˆ¶ç‰¹æ€§æ˜¯æ— æ³•é¿å…çš„ï¼Œå»¶è¿Ÿå–å†³äºç½‘ç»œå¸¦å®½å’Œå‘½ä»¤é˜»å¡æƒ…å†µã€‚éœ€è¦ä¸šåŠ¡åœºæ™¯å…è®¸çŸ­æ—¶é—´å†…çš„æ•°æ®å»¶è¿Ÿã€‚å¯¹äºæ— æ³•å®¹å¿å¤§é‡å»¶è¿Ÿåœºæ™¯ï¼Œå¯ä»¥ç¼–å†™å¤–éƒ¨ç›‘æ§ç¨‹åºç›‘å¬ä¸»ä»èŠ‚ç‚¹çš„å¤åˆ¶åç§»é‡ï¼Œå½“å»¶è¿Ÿè¾ƒå¤§æ—¶è§¦å‘æŠ¥è­¦æˆ–è€…é€šçŸ¥å®¢æˆ·ç«¯é¿å…è¯»å–å»¶è¿Ÿè¿‡é«˜çš„ä»èŠ‚ç‚¹ã€‚</p>
<h3 id="è¯»åˆ°è¿‡æœŸæ•°æ®"><a href="#è¯»åˆ°è¿‡æœŸæ•°æ®" class="headerlink" title="è¯»åˆ°è¿‡æœŸæ•°æ®"></a>è¯»åˆ°è¿‡æœŸæ•°æ®</h3><p>æƒ°æ€§åˆ é™¤ï¼šä¸»èŠ‚ç‚¹å°†è¿‡æœŸçš„é”®åŒæ­¥ç»™ä»èŠ‚ç‚¹<br>å®šæ—¶åˆ é™¤ï¼šä¸»èŠ‚ç‚¹è½®è¯¢é‡‡æ ·ä¸€å®šæ•°é‡çš„é”®ï¼Œå½“é‡‡æ ·çš„é”®è¿‡æœŸåï¼ŒåŒæ­¥ç»™ä»èŠ‚ç‚¹ã€‚<br>Redis 3.2+ åœ¨ä»èŠ‚ç‚¹è¯»å–é”®æ—¶ä¼šæ ¡éªŒæ˜¯å¦è¿‡æœŸä»¥åˆ¤æ–­æ˜¯å¦è¿”å›æ•°æ®ã€‚</p>
<h3 id="ä»èŠ‚ç‚¹æ•…éšœ"><a href="#ä»èŠ‚ç‚¹æ•…éšœ" class="headerlink" title="ä»èŠ‚ç‚¹æ•…éšœ"></a>ä»èŠ‚ç‚¹æ•…éšœ</h3><p>ä¸‹çº¿æ•…éšœèŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>å½“ä¸»èŠ‚ç‚¹ä¼˜åŒ–ç©ºé—´ä¸å¤§æ—¶å†è€ƒè™‘æ‰©å±•ã€‚ç¬”è€…å»ºè®®å¤§å®¶åœ¨åšè¯»å†™åˆ†ç¦»ä¹‹å‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Redis Clusterç­‰åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œè¿™æ ·ä¸æ­¢æ‰©å±•äº†è¯»æ€§èƒ½è¿˜å¯ä»¥æ‰©å±•å†™æ€§èƒ½å’Œå¯æ”¯æ’‘æ•°æ®è§„æ¨¡ï¼Œå¹¶ä¸”ä¸€è‡´æ€§å’Œæ•…éšœè½¬ç§»ä¹Ÿå¯ä»¥å¾—åˆ°ä¿è¯ï¼Œå¯¹äºå®¢æˆ·ç«¯çš„ç»´æŠ¤é€»è¾‘ä¹Ÿç›¸å¯¹å®¹æ˜“ã€‚</p>
</blockquote>
<h3 id="è§„é¿å…¨é‡å¤åˆ¶"><a href="#è§„é¿å…¨é‡å¤åˆ¶" class="headerlink" title="è§„é¿å…¨é‡å¤åˆ¶"></a>è§„é¿å…¨é‡å¤åˆ¶</h3><ul>
<li>ç¬¬ä¸€æ¬¡å»ºç«‹å¤åˆ¶ï¼šç”±äºæ˜¯ç¬¬ä¸€æ¬¡å»ºç«‹å¤åˆ¶ï¼Œä»èŠ‚ç‚¹ä¸åŒ…å«ä»»ä½•ä¸»èŠ‚ç‚¹æ•°æ®ï¼Œå› æ­¤å¿…é¡»è¿›è¡Œå…¨é‡å¤åˆ¶æ‰èƒ½å®Œæˆæ•°æ®åŒæ­¥ã€‚å¯¹äºè¿™ç§æƒ…å†µå…¨é‡å¤åˆ¶æ— æ³•é¿å…ã€‚å½“å¯¹æ•°æ®é‡è¾ƒå¤§ä¸”æµé‡è¾ƒé«˜çš„ä¸»èŠ‚ç‚¹æ·»åŠ ä»èŠ‚ç‚¹æ—¶ï¼Œå»ºè®®åœ¨ä½å³°æ—¶è¿›è¡Œæ“ä½œï¼Œæˆ–è€…å°½é‡è§„é¿ä½¿ç”¨å¤§æ•°æ®é‡çš„RedisèŠ‚ç‚¹ã€‚</li>
<li>èŠ‚ç‚¹è¿è¡ŒIDä¸åŒ¹é…ï¼šå½“ä¸»ä»å¤åˆ¶å…³ç³»å»ºç«‹åï¼Œä»èŠ‚ç‚¹ä¼šä¿å­˜ä¸»èŠ‚ç‚¹çš„è¿è¡ŒIDï¼Œå¦‚æœæ­¤æ—¶ä¸»èŠ‚ç‚¹å› æ•…éšœé‡å¯ï¼Œé‚£ä¹ˆå®ƒçš„è¿è¡ŒIDä¼šæ”¹å˜ï¼Œä»èŠ‚ç‚¹å‘ç°ä¸»èŠ‚ç‚¹è¿è¡ŒIDä¸åŒ¹é…æ—¶ï¼Œä¼šè®¤ä¸ºè‡ªå·±å¤åˆ¶çš„æ˜¯ä¸€ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹ä»è€Œè¿›è¡Œå…¨é‡å¤åˆ¶ã€‚å¯¹äºè¿™ç§æƒ…å†µåº”è¯¥ä»æ¶æ„ä¸Šè§„é¿ï¼Œæ¯”å¦‚æä¾›æ•…éšœè½¬ç§»åŠŸèƒ½ã€‚å½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœåï¼Œæ‰‹åŠ¨æå‡ä»èŠ‚ç‚¹ä¸ºä¸»èŠ‚ç‚¹æˆ–è€…é‡‡ç”¨æ”¯æŒè‡ªåŠ¨æ•…éšœè½¬ç§»çš„å“¨å…µæˆ–é›†ç¾¤æ–¹æ¡ˆã€‚</li>
<li>å¤åˆ¶ç§¯å‹ç¼“å†²åŒºä¸è¶³ï¼šå½“ä¸»ä»èŠ‚ç‚¹ç½‘ç»œä¸­æ–­åï¼Œä»èŠ‚ç‚¹å†æ¬¡è¿ä¸Šä¸»èŠ‚ç‚¹æ—¶ä¼šå‘é€<code>psync {offset} {runId}</code>å‘½ä»¤è¯·æ±‚éƒ¨åˆ†å¤åˆ¶ï¼Œ<strong>å¦‚æœè¯·æ±‚çš„åç§»é‡ä¸åœ¨ä¸»èŠ‚ç‚¹çš„ç§¯å‹ç¼“å†²åŒºå†…ï¼Œåˆ™æ— æ³•æä¾›ç»™ä»èŠ‚ç‚¹æ•°æ®ï¼Œå› æ­¤éƒ¨åˆ†å¤åˆ¶ä¼šé€€åŒ–ä¸ºå…¨é‡å¤åˆ¶</strong>ã€‚æ­¤æ—¶éœ€è¦ä¿è¯<code>repl_backlog_size &gt; net_break_time*write_size_per_minute</code>ä»¥é¿å…ç¼“å†²åŒºä¸è¶³å¼•å‘çš„å…¨é‡å¤åˆ¶ã€‚</li>
</ul>
<h3 id="è§„é¿å¤åˆ¶é£æš´"><a href="#è§„é¿å¤åˆ¶é£æš´" class="headerlink" title="è§„é¿å¤åˆ¶é£æš´"></a>è§„é¿å¤åˆ¶é£æš´</h3><h4 id="å•ä¸»èŠ‚ç‚¹å¤åˆ¶é£æš´"><a href="#å•ä¸»èŠ‚ç‚¹å¤åˆ¶é£æš´" class="headerlink" title="å•ä¸»èŠ‚ç‚¹å¤åˆ¶é£æš´"></a>å•ä¸»èŠ‚ç‚¹å¤åˆ¶é£æš´</h4><p>ä¸€èˆ¬å‘ç”Ÿåœ¨ä¸»èŠ‚ç‚¹æŒ‚è½½å¤šä¸ªä»èŠ‚ç‚¹çš„åœºæ™¯ã€‚å½“ä¸»èŠ‚ç‚¹é‡å¯æ¢å¤åï¼Œä»èŠ‚ç‚¹ä¼šå‘èµ·å…¨é‡å¤åˆ¶æµç¨‹ï¼Œè¿™æ—¶ä¸»èŠ‚ç‚¹å°±ä¼šä¸ºä»èŠ‚ç‚¹åˆ›å»ºRDBå¿«ç…§ï¼Œå¦‚æœåœ¨å¿«ç…§åˆ›å»ºå®Œæ¯•ä¹‹å‰ï¼Œæœ‰å¤šä¸ªä»èŠ‚ç‚¹éƒ½å°è¯•ä¸ä¸»èŠ‚ç‚¹è¿›è¡Œå…¨é‡åŒæ­¥ï¼Œé‚£ä¹ˆå…¶ä»–ä»èŠ‚ç‚¹å°†å…±äº«è¿™ä»½RDBå¿«ç…§ï¼ŒåŒæ—¶å‘å¤šä¸ªä»èŠ‚ç‚¹å‘é€RDBå¿«ç…§ï¼Œå¯èƒ½ä½¿ä¸»èŠ‚ç‚¹çš„ç½‘ç»œå¸¦å®½æ¶ˆè€—ä¸¥é‡ï¼Œé€ æˆä¸»èŠ‚ç‚¹çš„å»¶è¿Ÿå˜å¤§ï¼Œæç«¯æƒ…å†µä¼šå‘ç”Ÿä¸»ä»èŠ‚ç‚¹è¿æ¥æ–­å¼€ï¼Œå¯¼è‡´å¤åˆ¶å¤±è´¥ã€‚<br>è§£å†³æ–¹æ¡ˆå¯ä»¥å‡å°‘ä¸»èŠ‚ç‚¹æŒ‚è½½çš„ä»èŠ‚ç‚¹æ•°é‡ï¼Œæˆ–è€…é‡‡ç”¨æ ‘å½¢å¤åˆ¶ç»“æ„(è¿™ç§æ ‘çŠ¶ç»“æ„ä¹Ÿå¸¦æ¥äº†è¿ç»´çš„å¤æ‚æ€§ï¼Œå¢åŠ äº†æ‰‹åŠ¨å’Œè‡ªåŠ¨å¤„ç†æ•…éšœè½¬ç§»çš„éš¾åº¦)ã€‚</p>
<h4 id="å•æœºå™¨å¤åˆ¶é£æš´"><a href="#å•æœºå™¨å¤åˆ¶é£æš´" class="headerlink" title="å•æœºå™¨å¤åˆ¶é£æš´"></a>å•æœºå™¨å¤åˆ¶é£æš´</h4><p><img src="https://tva1.sinaimg.cn/large/006y8mN6ly1g91z58ncm8j30iv0frgpv.jpg" alt=""></p>
<ul>
<li>åº”è¯¥æŠŠä¸»èŠ‚ç‚¹å°½é‡åˆ†æ•£åœ¨å¤šå°æœºå™¨ä¸Šï¼Œé¿å…åœ¨å•å°æœºå™¨ä¸Šéƒ¨ç½²è¿‡å¤šçš„ä¸»èŠ‚ç‚¹ã€‚</li>
<li>å½“ä¸»èŠ‚ç‚¹æ‰€åœ¨æœºå™¨æ•…éšœåæä¾›æ•…éšœè½¬ç§»æœºåˆ¶ï¼Œé¿å…æœºå™¨æ¢å¤åè¿›è¡Œå¯†é›†çš„å…¨é‡å¤åˆ¶ã€‚</li>
</ul>
<h1 id="ç¬¬-7-ç« -é˜»å¡"><a href="#ç¬¬-7-ç« -é˜»å¡" class="headerlink" title="ç¬¬ 7 ç«  é˜»å¡"></a>ç¬¬ 7 ç«  é˜»å¡</h1><p>å‘ç”Ÿé˜»å¡ä¼šæœ‰å†…åœ¨ä¸å¤–åœ¨åŸå› <br>å†…åœ¨åŸå› ï¼šä¸åˆç†åœ°ä½¿ç”¨APIæˆ–æ•°æ®ç»“æ„ã€CPUé¥±å’Œã€æŒä¹…åŒ–é˜»å¡ç­‰<br>å¤–åœ¨åŸå› ï¼šCPUç«äº‰ã€å†…å­˜äº¤æ¢ã€ç½‘ç»œé—®é¢˜ç­‰</p>
<h1 id="ç¬¬-8-ç« -ç†è§£å†…å­˜"><a href="#ç¬¬-8-ç« -ç†è§£å†…å­˜" class="headerlink" title="ç¬¬ 8 ç«  ç†è§£å†…å­˜"></a>ç¬¬ 8 ç«  ç†è§£å†…å­˜</h1><h1 id="ç¬¬-9-ç« -å“¨å…µ"><a href="#ç¬¬-9-ç« -å“¨å…µ" class="headerlink" title="ç¬¬ 9 ç«  å“¨å…µ"></a>ç¬¬ 9 ç«  å“¨å…µ</h1><h1 id="ç¬¬-10-ç« -é›†ç¾¤"><a href="#ç¬¬-10-ç« -é›†ç¾¤" class="headerlink" title="ç¬¬ 10 ç«  é›†ç¾¤"></a>ç¬¬ 10 ç«  é›†ç¾¤</h1><h1 id="ç¬¬-11-ç« -ç¼“å­˜è®¾è®¡"><a href="#ç¬¬-11-ç« -ç¼“å­˜è®¾è®¡" class="headerlink" title="ç¬¬ 11 ç«  ç¼“å­˜è®¾è®¡"></a>ç¬¬ 11 ç«  ç¼“å­˜è®¾è®¡</h1><h1 id="ç¬¬-12-ç« -Devops-çš„é™·é˜±"><a href="#ç¬¬-12-ç« -Devops-çš„é™·é˜±" class="headerlink" title="ç¬¬ 12 ç«  Devops çš„é™·é˜±"></a>ç¬¬ 12 ç«  Devops çš„é™·é˜±</h1><h1 id="ç¬¬-13-ç« -Redis-ç›‘æ§è¿ç»´äº‘å¹³å°-CachedCloud"><a href="#ç¬¬-13-ç« -Redis-ç›‘æ§è¿ç»´äº‘å¹³å°-CachedCloud" class="headerlink" title="ç¬¬ 13 ç«  Redis ç›‘æ§è¿ç»´äº‘å¹³å° CachedCloud"></a>ç¬¬ 13 ç«  Redis ç›‘æ§è¿ç»´äº‘å¹³å° CachedCloud</h1><h1 id="ç¬¬-14-ç« -Redis-é…ç½®ç»Ÿè®¡å­—å…¸"><a href="#ç¬¬-14-ç« -Redis-é…ç½®ç»Ÿè®¡å­—å…¸" class="headerlink" title="ç¬¬ 14 ç«  Redis é…ç½®ç»Ÿè®¡å­—å…¸"></a>ç¬¬ 14 ç«  Redis é…ç½®ç»Ÿè®¡å­—å…¸</h1><hr>
<blockquote>
<p>è¯»åæ„Ÿï¼šRedis æ˜¯ä¸€æ¬¾å¼ºæœ‰åŠ›çš„ç”Ÿäº§åŠ›å·¥å…·ï¼Œåƒä¸€æŠŠç‘å£«å†›åˆ€ï¼Œåªæœ‰ä½ ç†Ÿæ‚‰è‡ªå·±ä½¿ç”¨çš„å·¥å…·ï¼Œæ‰èƒ½æ„å»ºå‡ºä¸€åº§åšå›ºæ¼‚äº®çš„å¤§å¦ã€‚ä½¿ç”¨ä»€ä¹ˆå·¥å…·å†³å®šäº†ä½ çš„ä¸‹é™ï¼Œä½†æ€ä¹ˆä½¿ç”¨å·¥å…·å†³å®šäº†ä½ çš„ä¸Šé™ï¼Œä½ å¯ä»¥ç”¨ Redis æ¥åšç¼“å­˜ï¼Œä¹Ÿå¯ä»¥ç”¨äºæµé‡å‰Šå³°ï¼Œå¹´ä¼šæŠ½å¥–ï¼Œç¤¾äº¤æ¨èã€‚æ‰€æœ‰å·¥å…·çš„èƒŒåéƒ½å–å†³äºäººï¼Œåˆ›æ–°äº§ç”Ÿä»·å€¼ã€‚</p>
</blockquote>

    </div>

    
    
    
      
        <div class="reward-container">
  <div>å› ä¸ºçƒ­çˆ±ï¼Œæ‰€ä»¥æ‰§ç€ã€‚</div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechat.png" alt="Palemoky WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="Palemoky Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Palemoky
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://blog.palemoky.top/post/redis-devops/" title="ã€ŠRediså¼€å‘ä¸è¿ç»´ã€‹">https://blog.palemoky.top/post/redis-devops/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/post/get-bank-info-by-unionpay/" rel="next" title="é“¶è”æŸ¥è¯¢é“¶è¡Œå¡ä¿¡æ¯">
                  <i class="fa fa-chevron-left"></i> é“¶è”æŸ¥è¯¢é“¶è¡Œå¡ä¿¡æ¯
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/post/Wall-of-Shame/" rel="prev" title="æŒ‚å—å¢™">
                  æŒ‚å—å¢™ <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-1-ç« -åˆè¯†-Redis"><span class="nav-text">ç¬¬ 1 ç«  åˆè¯† Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-æ•°æ®ç±»å‹"><span class="nav-text">Redis æ•°æ®ç±»å‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-æä¾›çš„åŠŸèƒ½"><span class="nav-text">Redis æä¾›çš„åŠŸèƒ½</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-ä½¿ç”¨åœºæ™¯"><span class="nav-text">Redis ä½¿ç”¨åœºæ™¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä¸ºä»€ä¹ˆ-Redis-å¾ˆå¿«ï¼Ÿ"><span class="nav-text">ä¸ºä»€ä¹ˆ Redis å¾ˆå¿«ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-å¯æ‰§è¡Œæ–‡ä»¶è¯´æ˜"><span class="nav-text">Redis å¯æ‰§è¡Œæ–‡ä»¶è¯´æ˜</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¯åŠ¨-Redis-çš„3ç§æ–¹å¼ï¼š"><span class="nav-text">å¯åŠ¨ Redis çš„3ç§æ–¹å¼ï¼š</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-2-ç« -API-çš„ç†è§£å’Œä½¿ç”¨"><span class="nav-text">ç¬¬ 2 ç«  API çš„ç†è§£å’Œä½¿ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆ¤æ–­é”®ä¸å­˜åœ¨çš„æ–¹æ³•ï¼š"><span class="nav-text">åˆ¤æ–­é”®ä¸å­˜åœ¨çš„æ–¹æ³•ï¼š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆ—è¡¨çš„å››ç§æ“ä½œç±»å‹"><span class="nav-text">åˆ—è¡¨çš„å››ç§æ“ä½œç±»å‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆ—è¡¨çš„ä½¿ç”¨åœºæ™¯ï¼š"><span class="nav-text">åˆ—è¡¨çš„ä½¿ç”¨åœºæ™¯ï¼š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é›†åˆçš„ä½¿ç”¨åœºæ™¯"><span class="nav-text">é›†åˆçš„ä½¿ç”¨åœºæ™¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆçš„å¼‚åŒç‚¹"><span class="nav-text">åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆçš„å¼‚åŒç‚¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-æ•°æ®ç»“æ„ä¸å†…éƒ¨ç¼–ç "><span class="nav-text">Redis æ•°æ®ç»“æ„ä¸å†…éƒ¨ç¼–ç </span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-3-ç« -å°åŠŸèƒ½å¤§ç”¨å¤„"><span class="nav-text">ç¬¬ 3 ç«  å°åŠŸèƒ½å¤§ç”¨å¤„</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ…¢æŸ¥è¯¢"><span class="nav-text">æ…¢æŸ¥è¯¢</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ…¢æŸ¥è¯¢é…ç½®"><span class="nav-text">æ…¢æŸ¥è¯¢é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ…¢æŸ¥è¯¢å‘½ä»¤"><span class="nav-text">æ…¢æŸ¥è¯¢å‘½ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ…¢æŸ¥è¯¢æ—¥å¿—ç»“æ„"><span class="nav-text">æ…¢æŸ¥è¯¢æ—¥å¿—ç»“æ„</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-Shell"><span class="nav-text">Redis Shell</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#redis-cli"><span class="nav-text">redis-cli</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redis-server"><span class="nav-text">redis-server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redis-benchmark"><span class="nav-text">redis-benchmark</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pipeline"><span class="nav-text">Pipeline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#äº‹åŠ¡ä¸-Lua"><span class="nav-text">äº‹åŠ¡ä¸ Lua</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨-Redis-ä¸­æ‰§è¡Œ-Lua-çš„æ–¹æ³•"><span class="nav-text">åœ¨ Redis ä¸­æ‰§è¡Œ Lua çš„æ–¹æ³•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bitmaps"><span class="nav-text">Bitmaps</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HyperLogLog"><span class="nav-text">HyperLogLog</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‘å¸ƒè®¢é˜…"><span class="nav-text">å‘å¸ƒè®¢é˜…</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GEO"><span class="nav-text">GEO</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-4-ç« -å®¢æˆ·ç«¯"><span class="nav-text">ç¬¬ 4 ç«  å®¢æˆ·ç«¯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å®¢æˆ·ç«¯å¸¸è§å¼‚å¸¸"><span class="nav-text">å®¢æˆ·ç«¯å¸¸è§å¼‚å¸¸</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®¢æˆ·ç«¯æ¡ˆä¾‹åˆ†æ"><span class="nav-text">å®¢æˆ·ç«¯æ¡ˆä¾‹åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Rediså†…å­˜é™¡å¢"><span class="nav-text">Rediså†…å­˜é™¡å¢</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç°è±¡"><span class="nav-text">ç°è±¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åˆ†æåŸå› "><span class="nav-text">åˆ†æåŸå› </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®¢æˆ·ç«¯å‘¨æœŸæ€§çš„è¶…æ—¶"><span class="nav-text">å®¢æˆ·ç«¯å‘¨æœŸæ€§çš„è¶…æ—¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç°è±¡-1"><span class="nav-text">ç°è±¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åˆ†æ"><span class="nav-text">åˆ†æ</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-5-ç« -æŒä¹…åŒ–"><span class="nav-text">ç¬¬ 5 ç«  æŒä¹…åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RDB"><span class="nav-text">RDB</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RDB-çš„ä¼˜ç¼ºç‚¹"><span class="nav-text">RDB çš„ä¼˜ç¼ºç‚¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AOF"><span class="nav-text">AOF</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é‡å¯åŠ è½½"><span class="nav-text">é‡å¯åŠ è½½</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é—®é¢˜å®šä½ä¸ä¼˜åŒ–"><span class="nav-text">é—®é¢˜å®šä½ä¸ä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#fork-æ“ä½œ"><span class="nav-text">fork æ“ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å­è¿›ç¨‹å¼€é”€ç›‘æ§å’Œä¼˜åŒ–"><span class="nav-text">å­è¿›ç¨‹å¼€é”€ç›‘æ§å’Œä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CPU"><span class="nav-text">CPU</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç¡¬ç›˜å¼€é”€"><span class="nav-text">ç¡¬ç›˜å¼€é”€</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOF-è¿½åŠ é˜»å¡"><span class="nav-text">AOF è¿½åŠ é˜»å¡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ¬ç« æ€»ç»“"><span class="nav-text">æœ¬ç« æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-6-ç« -å¤åˆ¶"><span class="nav-text">ç¬¬ 6 ç«  å¤åˆ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#å»ºç«‹å¤åˆ¶"><span class="nav-text">å»ºç«‹å¤åˆ¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ–­å¼€å¤åˆ¶"><span class="nav-text">æ–­å¼€å¤åˆ¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ‹“æ‰‘"><span class="nav-text">æ‹“æ‰‘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸€ä¸»ä¸€ä»"><span class="nav-text">ä¸€ä¸»ä¸€ä»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸€ä¸»å¤šä»"><span class="nav-text">ä¸€ä¸»å¤šä»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ ‘çŠ¶ä¸»ä»ç»“æ„"><span class="nav-text">æ ‘çŠ¶ä¸»ä»ç»“æ„</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åŸç†"><span class="nav-text">åŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ•°æ®åŒæ­¥"><span class="nav-text">æ•°æ®åŒæ­¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤åˆ¶åç§»é‡"><span class="nav-text">å¤åˆ¶åç§»é‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤åˆ¶ç§¯å‹ç¼“å†²åŒº"><span class="nav-text">å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸»èŠ‚ç‚¹è¿è¡ŒID"><span class="nav-text">ä¸»èŠ‚ç‚¹è¿è¡ŒID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#psync-å‘½ä»¤"><span class="nav-text">psync å‘½ä»¤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å…¨é‡åŒæ­¥"><span class="nav-text">å…¨é‡åŒæ­¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¢é‡åŒæ­¥"><span class="nav-text">å¢é‡åŒæ­¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¿ƒè·³"><span class="nav-text">å¿ƒè·³</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¼€å‘ä¸è¿ç»´ä¸­çš„é—®é¢˜"><span class="nav-text">å¼€å‘ä¸è¿ç»´ä¸­çš„é—®é¢˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ•°æ®å»¶æ—¶"><span class="nav-text">æ•°æ®å»¶æ—¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¯»åˆ°è¿‡æœŸæ•°æ®"><span class="nav-text">è¯»åˆ°è¿‡æœŸæ•°æ®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä»èŠ‚ç‚¹æ•…éšœ"><span class="nav-text">ä»èŠ‚ç‚¹æ•…éšœ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è§„é¿å…¨é‡å¤åˆ¶"><span class="nav-text">è§„é¿å…¨é‡å¤åˆ¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è§„é¿å¤åˆ¶é£æš´"><span class="nav-text">è§„é¿å¤åˆ¶é£æš´</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å•ä¸»èŠ‚ç‚¹å¤åˆ¶é£æš´"><span class="nav-text">å•ä¸»èŠ‚ç‚¹å¤åˆ¶é£æš´</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å•æœºå™¨å¤åˆ¶é£æš´"><span class="nav-text">å•æœºå™¨å¤åˆ¶é£æš´</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-7-ç« -é˜»å¡"><span class="nav-text">ç¬¬ 7 ç«  é˜»å¡</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-8-ç« -ç†è§£å†…å­˜"><span class="nav-text">ç¬¬ 8 ç«  ç†è§£å†…å­˜</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-9-ç« -å“¨å…µ"><span class="nav-text">ç¬¬ 9 ç«  å“¨å…µ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-10-ç« -é›†ç¾¤"><span class="nav-text">ç¬¬ 10 ç«  é›†ç¾¤</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-11-ç« -ç¼“å­˜è®¾è®¡"><span class="nav-text">ç¬¬ 11 ç«  ç¼“å­˜è®¾è®¡</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-12-ç« -Devops-çš„é™·é˜±"><span class="nav-text">ç¬¬ 12 ç«  Devops çš„é™·é˜±</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-13-ç« -Redis-ç›‘æ§è¿ç»´äº‘å¹³å°-CachedCloud"><span class="nav-text">ç¬¬ 13 ç«  Redis ç›‘æ§è¿ç»´äº‘å¹³å° CachedCloud</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ç¬¬-14-ç« -Redis-é…ç½®ç»Ÿè®¡å­—å…¸"><span class="nav-text">ç¬¬ 14 ç«  Redis é…ç½®ç»Ÿè®¡å­—å…¸</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Palemoky"
    src="/images/orca.jpg">
  <p class="site-author-name" itemprop="name">Palemoky</p>
  <div class="site-description" itemprop="description">Learn by doing !</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">65</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/palemoky" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;palemoky" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:palemoky@gmail.com" title="E-Mail &amp;rarr; mailto:palemoky@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2016 â€“ 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Palemoky Â© Copyright</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme â€“ <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.2
  </div>

        
<div class="busuanzi-count">
  <script pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.getAttribute('pjax') !== null) {
      element.setAttribute('pjax', '');
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  <script src="/js/local-search.js"></script>












    <div id="pjax">

  

  
      
<script type="text/x-mathjax-config">
    MathJax.Ajax.config.path['mhchem'] = '//cdn.jsdelivr.net/npm/mathjax-mhchem@3';

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        extensions: ['[mhchem]/mhchem.js'],
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://palemoky.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://blog.palemoky.top/post/redis-devops/",
            identifier: "post/redis-devops/",
            title: "ã€ŠRediså¼€å‘ä¸è¿ç»´ã€‹"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://palemoky.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    (function() {
      var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
      if (offsetTop <= 0) {
        // load directly when there's no a scrollbar
        window.addEventListener('load', loadComments, false);
      } else {
        var disqus_scroll = () => {
          // offsetTop may changes because of manually resizing browser window or lazy loading images.
          var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
          var scrollTop = window.scrollY;

          // pre-load comments a bit? (margin or anything else)
          if (offsetTop - scrollTop < 60) {
            window.removeEventListener('scroll', disqus_scroll);
            loadComments();
          }
        };
        window.addEventListener('scroll', disqus_scroll);
      }
    })();
  
</script>

    </div>
</body>
</html>
